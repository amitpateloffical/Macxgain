import{_ as B,c as r,o as n,b as s,i as h,h as _,t as l,n as d,F as f,r as v,j as C,W as I,a as x,S as m,X as p}from"./app-BFj7m03g.js";const N={name:"AITradingOrders",data(){return{user:{},loading:!1,userOrders:[],exitingTrade:null,statusFilter:"",sortBy:"created_at",showDetailedAnalysis:!1,liveStocks:{},autoRefreshInterval:null,marketStatus:{is_open:!1,status:"CLOSED",current_time:"",next_open_time:null},lastUpdate:null}},computed:{filteredOrders(){let e=[...this.userOrders];return this.statusFilter&&(e=e.filter(t=>t.status===this.statusFilter)),e.sort((t,u)=>{switch(this.sortBy){case"created_at":return new Date(u.created_at)-new Date(t.created_at);case"created_at_old":return new Date(t.created_at)-new Date(u.created_at);case"total_amount":return(u.total_amount||0)-(t.total_amount||0);case"total_amount_low":return(t.total_amount||0)-(u.total_amount||0);default:return new Date(u.created_at)-new Date(t.created_at)}}),e},closedTrades(){return this.userOrders.filter(e=>e.status==="CLOSED"&&e.pnl!==null&&e.pnl!==void 0)},profitableTrades(){return this.closedTrades.filter(e=>e.pnl>0)},lossTrades(){return this.closedTrades.filter(e=>e.pnl<0)},activeTrades(){return this.userOrders.filter(e=>e.status==="COMPLETED")},totalProfit(){return this.profitableTrades.reduce((e,t)=>e+parseFloat(t.pnl||0),0)},totalLoss(){return this.lossTrades.reduce((e,t)=>e+parseFloat(t.pnl||0),0)},overallPnL(){return this.totalProfit+this.totalLoss},totalInvested(){return this.userOrders.filter(e=>e.status==="COMPLETED"||e.status==="CLOSED").reduce((e,t)=>e+parseFloat(t.total_amount||0),0)},totalReturn(){return this.totalInvested+this.overallPnL},overallPnLPercentage(){if(this.totalInvested===0)return 0;const e=this.overallPnL/this.totalInvested*100;return isNaN(e)?0:e},winRate(){const e=this.closedTrades.length;return e===0?0:this.profitableTrades.length/e*100},avgProfitPerTrade(){const e=this.closedTrades.length;if(e===0)return 0;const t=this.overallPnL/e;return isNaN(t)?0:t},totalActiveInvestment(){return this.activeTrades.reduce((e,t)=>e+parseFloat(t.total_amount||0),0)},updatedBalance(){return parseFloat(this.user.balance||0)+this.overallPnL}},mounted(){if(this.user={id:this.$route.query.userId,name:this.$route.query.userName,balance:parseFloat(this.$route.query.userBalance)||0,email:this.$route.query.userEmail},!this.user.id){this.showError("User data not found. Please go back and try again."),this.goBack();return}this.loadUserOrders(),this.loadUserBalance(),this.loadMarketStatus(),this.loadMarketData(),this.startAutoRefresh()},methods:{goBack(){this.$router.push({name:"ai_trading_session",query:{userId:this.user.id,userName:this.user.name,userBalance:this.user.balance,userEmail:this.user.email}})},async loadUserOrders(){try{this.loading=!0;const e=localStorage.getItem("access_token"),t=await p.get(`/api/ai-trading/user-orders/${this.user.id}`,{headers:{Authorization:`Bearer ${e}`,Accept:"application/json"}});t.data.success&&(this.userOrders=t.data.orders||[],this.lastUpdate=new Date().toLocaleTimeString())}catch(e){console.error("Error loading user orders:",e),this.showError("Failed to load orders")}finally{this.loading=!1}},async loadUserBalance(){try{const e=localStorage.getItem("access_token"),t=await p.get(`/api/ai-trading/user-balance/${this.user.id}`,{headers:{Authorization:`Bearer ${e}`,Accept:"application/json"}});t.data.success&&(this.user.balance=t.data.balance)}catch(e){console.error("Error loading user balance:",e)}},async loadMarketStatus(){try{const e=localStorage.getItem("access_token"),t=await p.get("/api/ai-trading/market-status",{headers:{Authorization:`Bearer ${e}`,Accept:"application/json"}});t.data.success&&(this.marketStatus=t.data.data)}catch(e){console.error("Error loading market status:",e),this.marketStatus={is_open:!1,status:"CLOSED",current_time:new Date().toLocaleTimeString("en-IN"),next_open_time:null}}},async loadMarketData(){try{const e=localStorage.getItem("access_token"),t=await p.get("/api/truedata/live-data",{headers:{Authorization:`Bearer ${e}`,Accept:"application/json"},params:{_t:Date.now()}});t.data.success&&t.data.data&&(this.liveStocks=t.data.data,this.lastUpdate=new Date().toLocaleTimeString(),console.log("Live market data loaded:",Object.keys(this.liveStocks).length,"symbols"))}catch(e){console.error("Error loading live market data:",e)}},async refreshMarketData(){await this.loadMarketData(),this.showSuccess("Market data refreshed")},async refreshAllData(){this.loading=!0;try{await Promise.all([this.loadUserOrders(),this.loadUserBalance(),this.loadMarketStatus(),this.loadMarketData()]),this.showSuccess("All data refreshed successfully")}catch{this.showError("Failed to refresh some data")}finally{this.loading=!1}},startAutoRefresh(){this.autoRefreshInterval=setInterval(()=>{this.marketStatus.is_open&&(this.loadMarketData(),this.loadUserOrders())},1e4)},async exitTrade(e){try{this.exitingTrade=e;const t=localStorage.getItem("access_token"),u=await p.post(`/api/ai-trading/orders/${e}/exit`,{},{headers:{Authorization:`Bearer ${t}`,Accept:"application/json"}});u.data.success?(this.showSuccess("Trade exited successfully"),await this.loadUserOrders(),await this.loadUserBalance()):this.showError(u.data.message||"Failed to exit trade")}catch(t){console.error("Error exiting trade:",t),this.showError("Failed to exit trade")}finally{this.exitingTrade=null}},getOrdersByStatus(e){return this.userOrders.filter(t=>t.status===e)},formatDateTime(e){return new Date(e).toLocaleString("en-IN")},formatDate(e){return new Date(e).toLocaleDateString("en-IN")},showSuccess(e){typeof m<"u"?m.fire({title:"Success!",text:e,icon:"success",timer:3e3,showConfirmButton:!1,toast:!0,position:"top-end"}):(console.log("Success:",e),alert("Success: "+e))},showError(e){typeof m<"u"?m.fire({title:"Error!",text:e,icon:"error",timer:4e3,showConfirmButton:!1,toast:!0,position:"top-end"}):(console.error("Error:",e),alert("Error: "+e))},getStatusIcon(e){switch(e){case"COMPLETED":return"fa-check-circle";case"PENDING":return"fa-clock";case"CANCELLED":return"fa-times-circle";case"CLOSED":return"fa-lock";default:return"fa-question-circle"}},getOptionIcon(e){switch(e){case"CALL":return"fa-arrow-up";case"PUT":return"fa-arrow-down";default:return"fa-question"}},getActionIcon(e){switch(e){case"BUY":return"fa-shopping-cart";case"SELL":return"fa-money-bill-wave";default:return"fa-exchange-alt"}}},beforeUnmount(){this.autoRefreshInterval&&clearInterval(this.autoRefreshInterval)}},F={class:"ai-trading-orders"},U={class:"page-header"},M={class:"header-content"},R={class:"user-info"},q={class:"page-subtitle"},j={class:"header-actions"},V=["disabled"],z=["disabled"],G={class:"market-status"},H={class:"market-time"},W={class:"last-update"},Q={class:"orders-summary"},X={class:"summary-card"},Y={class:"summary-item"},J={class:"summary-value"},K={class:"summary-item"},Z={class:"summary-value completed"},$={class:"summary-item"},ss={class:"summary-value pending"},ts={class:"summary-item"},es={class:"summary-value closed"},as={class:"pnl-analysis"},ls={class:"analysis-header"},os={class:"analysis-toggle"},is={class:"pnl-summary"},rs={class:"pnl-icon"},ns={class:"pnl-info"},ds={class:"pnl-value"},cs={class:"pnl-percentage"},us={class:"pnl-stats"},hs={class:"stat-item"},_s={class:"stat-value"},ps={class:"stat-item"},fs={class:"stat-value"},vs={class:"stat-item"},ms={class:"stat-item"},gs={key:0,class:"detailed-analysis"},ys={class:"analysis-grid"},ks={class:"analysis-section profit-section"},Ls={class:"section-header"},ws={class:"trades-list"},bs={class:"trade-info"},Ss={class:"trade-symbol"},Ts={class:"trade-type"},Ds={class:"trade-pnl"},Es={class:"pnl-amount"},Ps={class:"trade-date"},Os={class:"section-total"},As={class:"analysis-section loss-section"},Cs={class:"section-header"},Is={class:"trades-list"},Bs={class:"trade-info"},xs={class:"trade-symbol"},Ns={class:"trade-type"},Fs={class:"trade-pnl"},Us={class:"pnl-amount"},Ms={class:"trade-date"},Rs={class:"section-total"},qs={class:"analysis-section active-section"},js={class:"section-header"},Vs={class:"trades-list"},zs={class:"trade-info"},Gs={class:"trade-symbol"},Hs={class:"trade-type"},Ws={class:"trade-pnl"},Qs={class:"pnl-amount"},Xs={class:"trade-date"},Ys={class:"section-total"},Js={class:"orders-container"},Ks={class:"orders-header"},Zs={class:"filter-controls"},$s={key:0,class:"loading-container"},st={key:1,class:"empty-state"},tt={key:2,class:"orders-list"},et={class:"order-header"},at={class:"order-info"},lt={class:"order-symbol"},ot={class:"order-id"},it={class:"order-status"},rt={class:"order-details"},nt={class:"detail-row"},dt={class:"detail-row"},ct={class:"detail-row"},ut={class:"detail-value"},ht={class:"detail-row"},_t={class:"detail-value"},pt={class:"detail-row"},ft={class:"detail-value amount"},vt={class:"detail-row"},mt={class:"detail-value"},gt={key:0,class:"detail-row"},yt={class:"detail-value"},kt={key:1,class:"detail-row"},Lt={key:0,class:"order-actions"},wt=["onClick","disabled"],bt={key:0,class:"fas fa-sign-out-alt"},St={key:1,class:"fas fa-spinner fa-spin"},Tt={key:1,class:"order-actions"},Dt={class:"trade-closed-info"};function Et(e,t,u,Pt,i,o){var g,y,k,L,w,b,S,T,D,E,P,O;return n(),r("div",F,[s("div",U,[s("div",M,[s("button",{class:"back-btn",onClick:t[0]||(t[0]=(...a)=>o.goBack&&o.goBack(...a))},t[6]||(t[6]=[s("i",{class:"fas fa-arrow-left"},null,-1),h(" Back to AI Trading Session ")])),s("div",R,[t[8]||(t[8]=s("h1",{class:"page-title"},"ðŸ“‹ Trading Orders",-1)),s("p",q,[t[7]||(t[7]=h(" Orders for: ")),s("strong",null,l(i.user.name||"Loading..."),1),h(" (Balance: â‚¹"+l(((g=i.user.balance)==null?void 0:g.toLocaleString())||"0")+") ",1),o.overallPnL!==0?(n(),r("span",{key:0,class:d(["balance-update",o.overallPnL>=0?"profit":"loss"])}," â†’ â‚¹"+l((y=o.updatedBalance)==null?void 0:y.toLocaleString())+" ("+l(o.overallPnL>=0?"+":"")+"â‚¹"+l((k=o.overallPnL)==null?void 0:k.toLocaleString())+") ",3)):_("",!0)])])]),s("div",j,[s("button",{class:"refresh-btn",onClick:t[1]||(t[1]=(...a)=>o.refreshAllData&&o.refreshAllData(...a)),disabled:i.loading},[s("i",{class:d(["fas fa-sync-alt",{"fa-spin":i.loading}])},null,2),h(" "+l(i.loading?"Loading...":"Refresh All"),1)],8,V),s("button",{class:"refresh-btn",onClick:t[2]||(t[2]=(...a)=>o.loadUserBalance&&o.loadUserBalance(...a)),disabled:i.loading},t[9]||(t[9]=[s("i",{class:"fas fa-wallet"},null,-1),h(" Refresh Balance ")]),8,z)])]),s("div",G,[s("div",{class:d(["status-indicator",i.marketStatus.is_open?"open":"closed"])},[t[10]||(t[10]=s("div",{class:"status-dot"},null,-1)),s("span",null,l(i.marketStatus.is_open?"Market LIVE":"Market CLOSED"),1),s("span",H,l(i.marketStatus.current_time)+" IST",1)],2),s("div",W," Last Update: "+l(i.lastUpdate||"Never"),1)]),s("div",Q,[s("div",X,[s("div",Y,[t[11]||(t[11]=s("span",{class:"summary-label"},"Total Orders",-1)),s("span",J,l(i.userOrders.length),1)]),s("div",K,[t[12]||(t[12]=s("span",{class:"summary-label"},"Completed",-1)),s("span",Z,l(o.getOrdersByStatus("COMPLETED").length),1)]),s("div",$,[t[13]||(t[13]=s("span",{class:"summary-label"},"Pending",-1)),s("span",ss,l(o.getOrdersByStatus("PENDING").length),1)]),s("div",ts,[t[14]||(t[14]=s("span",{class:"summary-label"},"Closed",-1)),s("span",es,l(o.getOrdersByStatus("CLOSED").length),1)])])]),s("div",as,[s("div",ls,[t[16]||(t[16]=s("h2",null,"ðŸ“Š Profit & Loss Analysis",-1)),s("div",os,[s("button",{class:d(["toggle-btn",{active:i.showDetailedAnalysis}]),onClick:t[3]||(t[3]=a=>i.showDetailedAnalysis=!i.showDetailedAnalysis)},[t[15]||(t[15]=s("i",{class:"fas fa-chart-line"},null,-1)),h(" "+l(i.showDetailedAnalysis?"Hide Details":"Show Details"),1)],2)])]),s("div",is,[s("div",{class:d(["pnl-card total-pnl",o.overallPnL>=0?"profit":"loss"])},[s("div",rs,[s("i",{class:d(["fas",o.overallPnL>=0?"fa-arrow-up":"fa-arrow-down"])},null,2)]),s("div",ns,[t[17]||(t[17]=s("span",{class:"pnl-label"},"Overall P&L",-1)),s("span",ds,l(o.overallPnL>=0?"+":"")+"â‚¹"+l((L=o.overallPnL)==null?void 0:L.toLocaleString()),1),s("span",cs," ("+l(o.overallPnLPercentage>=0?"+":"")+l((w=o.overallPnLPercentage)==null?void 0:w.toFixed(2))+"%) ",1)])],2),s("div",us,[s("div",hs,[t[18]||(t[18]=s("span",{class:"stat-label"},"Total Invested",-1)),s("span",_s,"â‚¹"+l((b=o.totalInvested)==null?void 0:b.toLocaleString()),1)]),s("div",ps,[t[19]||(t[19]=s("span",{class:"stat-label"},"Total Return",-1)),s("span",fs,"â‚¹"+l((S=o.totalReturn)==null?void 0:S.toLocaleString()),1)]),s("div",vs,[t[20]||(t[20]=s("span",{class:"stat-label"},"Win Rate",-1)),s("span",{class:d(["stat-value",o.winRate>=50?"profit":"loss"])},l((T=o.winRate)==null?void 0:T.toFixed(1))+"% ",3)]),s("div",ms,[t[21]||(t[21]=s("span",{class:"stat-label"},"Avg Profit per Trade",-1)),s("span",{class:d(["stat-value",o.avgProfitPerTrade>=0?"profit":"loss"])},l(o.avgProfitPerTrade>=0?"+":"")+"â‚¹"+l((D=o.avgProfitPerTrade)==null?void 0:D.toLocaleString()),3)])])]),i.showDetailedAnalysis?(n(),r("div",gs,[s("div",ys,[s("div",ks,[s("div",Ls,[t[22]||(t[22]=s("i",{class:"fas fa-trophy"},null,-1)),s("h3",null,"Profitable Trades ("+l(o.profitableTrades.length)+")",1)]),s("div",ws,[(n(!0),r(f,null,v(o.profitableTrades,a=>{var c;return n(),r("div",{key:a.id,class:"trade-item profit"},[s("div",bs,[s("span",Ss,l(a.stock_symbol),1),s("span",Ts,l(a.option_type)+" "+l(a.action),1)]),s("div",Ds,[s("span",Es,"+â‚¹"+l((c=a.pnl)==null?void 0:c.toLocaleString()),1),s("span",Ps,l(o.formatDate(a.closed_at||a.created_at)),1)])])}),128))]),s("div",Os,[s("span",null,"Total Profit: +â‚¹"+l((E=o.totalProfit)==null?void 0:E.toLocaleString()),1)])]),s("div",As,[s("div",Cs,[t[23]||(t[23]=s("i",{class:"fas fa-chart-line-down"},null,-1)),s("h3",null,"Loss Trades ("+l(o.lossTrades.length)+")",1)]),s("div",Is,[(n(!0),r(f,null,v(o.lossTrades,a=>{var c;return n(),r("div",{key:a.id,class:"trade-item loss"},[s("div",Bs,[s("span",xs,l(a.stock_symbol),1),s("span",Ns,l(a.option_type)+" "+l(a.action),1)]),s("div",Fs,[s("span",Us,l(a.pnl>=0?"+":"")+"â‚¹"+l((c=a.pnl)==null?void 0:c.toLocaleString()),1),s("span",Ms,l(o.formatDate(a.closed_at||a.created_at)),1)])])}),128))]),s("div",Rs,[s("span",null,"Total Loss: â‚¹"+l((P=Math.abs(o.totalLoss))==null?void 0:P.toLocaleString()),1)])]),s("div",qs,[s("div",js,[t[24]||(t[24]=s("i",{class:"fas fa-clock"},null,-1)),s("h3",null,"Active Trades ("+l(o.activeTrades.length)+")",1)]),s("div",Vs,[(n(!0),r(f,null,v(o.activeTrades,a=>{var c;return n(),r("div",{key:a.id,class:"trade-item active"},[s("div",zs,[s("span",Gs,l(a.stock_symbol),1),s("span",Hs,l(a.option_type)+" "+l(a.action),1)]),s("div",Ws,[s("span",Qs,"â‚¹"+l((c=a.total_amount)==null?void 0:c.toLocaleString()),1),s("span",Xs,l(o.formatDate(a.created_at)),1)])])}),128))]),s("div",Ys,[s("span",null,"Total Invested: â‚¹"+l((O=o.totalActiveInvestment)==null?void 0:O.toLocaleString()),1)])])])])):_("",!0)]),s("div",Js,[s("div",Ks,[t[27]||(t[27]=s("h2",null,"Trading Orders",-1)),s("div",Zs,[C(s("select",{"onUpdate:modelValue":t[4]||(t[4]=a=>i.statusFilter=a),class:"filter-select"},t[25]||(t[25]=[x('<option value="" data-v-23b2df4f>All Status</option><option value="COMPLETED" data-v-23b2df4f>Completed</option><option value="PENDING" data-v-23b2df4f>Pending</option><option value="CANCELLED" data-v-23b2df4f>Cancelled</option><option value="CLOSED" data-v-23b2df4f>Closed</option>',5)]),512),[[I,i.statusFilter]]),C(s("select",{"onUpdate:modelValue":t[5]||(t[5]=a=>i.sortBy=a),class:"filter-select"},t[26]||(t[26]=[s("option",{value:"created_at"},"Date (Newest)",-1),s("option",{value:"created_at_old"},"Date (Oldest)",-1),s("option",{value:"total_amount"},"Amount (High to Low)",-1),s("option",{value:"total_amount_low"},"Amount (Low to High)",-1)]),512),[[I,i.sortBy]])])]),i.loading?(n(),r("div",$s,t[28]||(t[28]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"Loading orders...",-1)]))):o.filteredOrders.length===0?(n(),r("div",st,[t[29]||(t[29]=s("i",{class:"fas fa-inbox"},null,-1)),t[30]||(t[30]=s("h3",null,"No Orders Found",-1)),s("p",null,l(i.statusFilter?`No orders with status: ${i.statusFilter}`:"This user hasn't placed any trades yet."),1)])):(n(),r("div",tt,[(n(!0),r(f,null,v(o.filteredOrders,a=>{var c,A;return n(),r("div",{key:a.id,class:d(["order-card",a.status.toLowerCase()])},[s("div",et,[s("div",at,[s("h3",lt,l(a.stock_symbol),1),s("span",ot,"#"+l(a.id),1)]),s("div",it,[s("i",{class:d(o.getStatusIcon(a.status))},null,2),s("span",null,l(a.status),1)])]),s("div",rt,[s("div",nt,[t[31]||(t[31]=s("span",{class:"detail-label"},"Option Type:",-1)),s("span",{class:d(["detail-value option-type",a.option_type.toLowerCase()])},[s("i",{class:d(o.getOptionIcon(a.option_type))},null,2),h(" "+l(a.option_type),1)],2)]),s("div",dt,[t[32]||(t[32]=s("span",{class:"detail-label"},"Action:",-1)),s("span",{class:d(["detail-value action-type",a.action.toLowerCase()])},[s("i",{class:d(o.getActionIcon(a.action))},null,2),h(" "+l(a.action),1)],2)]),s("div",ct,[t[33]||(t[33]=s("span",{class:"detail-label"},"Strike Price:",-1)),s("span",ut,"â‚¹"+l(a.strike_price),1)]),s("div",ht,[t[34]||(t[34]=s("span",{class:"detail-label"},"Quantity:",-1)),s("span",_t,l(a.quantity),1)]),s("div",pt,[t[35]||(t[35]=s("span",{class:"detail-label"},"Total Amount:",-1)),s("span",ft,"â‚¹"+l((c=a.total_amount)==null?void 0:c.toLocaleString()),1)]),s("div",vt,[t[36]||(t[36]=s("span",{class:"detail-label"},"Date:",-1)),s("span",mt,l(o.formatDateTime(a.created_at)),1)]),a.exit_price?(n(),r("div",gt,[t[37]||(t[37]=s("span",{class:"detail-label"},"Exit Price:",-1)),s("span",yt,"â‚¹"+l(a.exit_price),1)])):_("",!0),a.pnl!==null&&a.pnl!==void 0?(n(),r("div",kt,[t[38]||(t[38]=s("span",{class:"detail-label"},"P&L:",-1)),s("span",{class:d(["detail-value pnl",a.pnl>=0?"profit":"loss"])},l(a.pnl>=0?"+":"")+"â‚¹"+l((A=a.pnl)==null?void 0:A.toLocaleString()),3)])):_("",!0)]),a.status==="COMPLETED"?(n(),r("div",Lt,[s("button",{class:"exit-trade-btn",onClick:Ot=>o.exitTrade(a.id),disabled:i.exitingTrade===a.id,title:"Exit trade - 24/7 trading enabled"},[i.exitingTrade!==a.id?(n(),r("i",bt)):(n(),r("i",St)),h(" "+l(i.exitingTrade===a.id?"Exiting...":"Exit Trade"),1)],8,wt),t[39]||(t[39]=s("div",{class:"trading-enabled-notice"},[s("i",{class:"fas fa-rocket"}),s("span",null,"24/7 trading enabled - Exit anytime!")],-1))])):a.status==="CLOSED"?(n(),r("div",Tt,[s("div",Dt,[t[40]||(t[40]=s("i",{class:"fas fa-check-circle"},null,-1)),s("span",null,"Trade Closed - "+l(a.closed_at?o.formatDateTime(a.closed_at):"Recently"),1)])])):_("",!0)],2)}),128))]))])])}const Ct=B(N,[["render",Et],["__scopeId","data-v-23b2df4f"]]);export{Ct as default};
