import{_ as X,f as r,D as m,E as G,L as H,g as $,c as n,o as i,a as J,b as e,l as C,h as c,n as v,t as l,F as K,r as Q,q as Y,i as j,s as V}from"./app-BFj7m03g.js";import{A as Z}from"./AdminMobileNav-DI3t1v3n.js";const tt={class:"withdrawal-request-screen"},et={class:"stats-grid"},st={class:"stat-content"},at={class:"stat-number"},lt={class:"stat-content"},ot={class:"stat-number"},nt={class:"stat-content"},it={class:"stat-number"},dt={class:"stat-content"},rt={class:"stat-number"},ct={class:"stat-card amount"},ut={class:"stat-content"},vt={class:"stat-number"},pt={class:"requests-container"},mt={key:0,class:"no-requests"},ft={key:1,class:"requests-grid"},gt={class:"request-header"},_t={class:"user-info"},bt={class:"user-avatar"},kt=["src","alt","onError","onLoad"],ht={class:"user-details"},jt={class:"user-name"},wt={class:"user-email"},yt={class:"user-phone"},Rt={class:"status-badge"},Ct={class:"request-details"},xt={class:"detail-row"},qt={class:"detail-value amount"},Nt={class:"detail-row"},Pt={class:"detail-value"},At={key:0,class:"detail-row"},$t={class:"detail-value bank-details"},Vt={key:1,class:"detail-row"},Dt={class:"detail-value reject-reason"},Et={key:2,class:"detail-row"},Lt={class:"detail-value"},Ft={class:"request-actions"},St=["onClick"],Mt=["onClick"],Bt={key:2,class:"btn-action btn-lock",disabled:""},It={class:"status-timeline"},Tt={class:"timeline-content"},Ut={class:"timeline-date"},Wt={class:"timeline-icon"},zt={class:"timeline-content"},Ot={class:"timeline-status"},Xt={key:0,class:"timeline-date"},Gt={class:"request-actions mt-3 d-flex justify-content-end"},Ht={key:0,class:"pagination"},Jt=["disabled"],Kt=["disabled"],Qt={key:1,class:"loading-indicator"},Yt={__name:"WithdrawalRequest",setup(Zt){const o=r("all"),u=r([]),w=r(!1),d=r(1),x=r(10),q=r(0),_=r(!1),f=r(""),y=r(null),D=m(()=>u.value.length),E=m(()=>u.value.filter(a=>a.status==="pending").length),L=m(()=>u.value.filter(a=>a.status==="approved").length),F=m(()=>u.value.filter(a=>a.status==="rejected").length),S=m(()=>u.value.filter(a=>a.status==="approved").reduce((a,t)=>a+parseFloat(t.amount||0),0)),N=m(()=>o.value==="all"?u.value:u.value.filter(a=>a.status===o.value)),k=m(()=>Math.ceil(q.value/x.value)),M=a=>a?a.startsWith("http")?a:`${window.location.origin}/storage/${a}`:"/build/assets/tableprofileimg-DaN7tIxX.png",B=(a,t)=>{console.log(`Profile image failed to load for ${t}, creating initials fallback`),console.log("Failed image src:",a.target.src),a.target.style.display="none";const p=t.split(" ").map(s=>s[0]).join("").toUpperCase().substring(0,3),g=document.createElement("div");g.className="profile-initials-fallback",g.textContent=p,g.style.cssText=`
    width: 45px;
    height: 45px;
    border-radius: 50%;
    background: linear-gradient(135deg, #00ff80, #00cc66);
    color: #000;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 14px;
    border: 3px solid #00ff80;
  `,a.target.parentNode.appendChild(g)},b=async()=>{try{w.value=!0;const a=await V.get("/withdrawal-request",{params:{page:d.value,perPage:x.value,status:o.value==="all"?null:o.value}});u.value=a.data.data,q.value=a.data.total}catch(a){console.error("Error fetching requests:",a),alert("Failed to load withdrawal requests")}finally{w.value=!1}},P=async(a,t)=>{try{const p=t==="rejected"?{reject_reason:f.value}:{};await V.patch(`/withdrawal-request/${a}/status`,{status:t,...p}),await b(),t==="rejected"&&(_.value=!1,f.value="",y.value=null),alert(`Request has been ${t} successfully!`)}catch(p){console.error("Error updating request status:",p),alert("Failed to update request status")}},I=a=>{y.value=a,f.value="",_.value=!0},T=()=>{if(!f.value.trim()){alert("Please enter a rejection reason");return}P(y.value,"rejected")},A=a=>({pending:"status-pending",approved:"status-approved",rejected:"status-rejected"})[a]||"status-pending",U=a=>({pending:"Pending",approved:"Approved",rejected:"Rejected"})[a]||"Pending",h=a=>a?new Date(a).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",W=a=>a?parseFloat(a).toLocaleString("en-IN"):"0",z=()=>{d.value<k.value&&(d.value++,b())},O=()=>{d.value>1&&(d.value--,b())};return G(b),H(o,(a,t)=>{a!==t&&(d.value=1,b())}),(a,t)=>{const p=$("b-form-textarea"),g=$("b-modal");return i(),n("div",tt,[t[32]||(t[32]=J('<div class="page-header" data-v-c6c14dda><div class="header-content" data-v-c6c14dda><h1 class="page-title" data-v-c6c14dda>ðŸ’³ Withdrawal Request</h1><p class="page-subtitle" data-v-c6c14dda>Manage and process withdrawal requests from users</p></div><div class="header-actions" data-v-c6c14dda></div></div>',1)),e("div",et,[e("div",{class:v(["stat-card total clickable",{active:o.value==="all"}]),onClick:t[0]||(t[0]=s=>o.value="all")},[t[8]||(t[8]=e("div",{class:"stat-icon"},"ðŸ“Š",-1)),e("div",st,[e("div",at,l(D.value||0),1),t[7]||(t[7]=e("div",{class:"stat-label"},"Total Requests",-1))])],2),e("div",{class:v(["stat-card pending clickable",{active:o.value==="pending"}]),onClick:t[1]||(t[1]=s=>o.value="pending")},[t[10]||(t[10]=e("div",{class:"stat-icon"},"â³",-1)),e("div",lt,[e("div",ot,l(E.value||0),1),t[9]||(t[9]=e("div",{class:"stat-label"},"Pending",-1))])],2),e("div",{class:v(["stat-card approved clickable",{active:o.value==="approved"}]),onClick:t[2]||(t[2]=s=>o.value="approved")},[t[12]||(t[12]=e("div",{class:"stat-icon"},"âœ…",-1)),e("div",nt,[e("div",it,l(L.value||0),1),t[11]||(t[11]=e("div",{class:"stat-label"},"Approved",-1))])],2),e("div",{class:v(["stat-card rejected clickable",{active:o.value==="rejected"}]),onClick:t[3]||(t[3]=s=>o.value="rejected")},[t[14]||(t[14]=e("div",{class:"stat-icon"},"âŒ",-1)),e("div",dt,[e("div",rt,l(F.value||0),1),t[13]||(t[13]=e("div",{class:"stat-label"},"Rejected",-1))])],2),e("div",ct,[t[16]||(t[16]=e("div",{class:"stat-icon"},"ðŸ’°",-1)),e("div",ut,[e("div",vt,"â‚¹"+l(W(S.value)),1),t[15]||(t[15]=e("div",{class:"stat-label"},"Total Amount",-1))])])]),C(Z),e("div",pt,[N.value.length===0?(i(),n("div",mt,[t[17]||(t[17]=e("div",{class:"no-requests-icon"},"ðŸ“­",-1)),e("h3",null,"No "+l(o.value==="all"?"":o.value)+" requests found",1),t[18]||(t[18]=e("p",null,"No withdrawal requests available at the moment",-1))])):(i(),n("div",ft,[(i(!0),n(K,null,Q(N.value,s=>(i(),n("div",{key:s.id,class:v(["request-card",A(s.status)])},[e("div",gt,[e("div",_t,[e("div",bt,[e("img",{src:M(s.requester.profile_image),alt:s.requester.name,onError:R=>B(R,s.requester.name),onLoad:()=>console.log("Profile image loaded successfully for:",s.requester.name)},null,40,kt)]),e("div",ht,[e("h4",jt,l(s.requester.name),1),e("p",wt,l(s.requester.email),1),e("p",yt,l(s.requester.mobile_code)+" "+l(s.requester.phone),1)])]),e("div",{class:v(["request-status",A(s.status)])},[e("span",Rt,l(U(s.status)),1)],2)]),e("div",Ct,[e("div",xt,[t[19]||(t[19]=e("span",{class:"detail-label"},"Amount:",-1)),e("span",qt,"â‚¹"+l(parseFloat(s.amount).toLocaleString()),1)]),e("div",Nt,[t[20]||(t[20]=e("span",{class:"detail-label"},"Requested:",-1)),e("span",Pt,l(h(s.created_at)),1)]),s.requester.bank_name?(i(),n("div",At,[t[21]||(t[21]=e("span",{class:"detail-label"},"Bank Details:",-1)),e("span",$t,l(s.requester.bank_name)+" - "+l(s.requester.account_no)+" - "+l(s.requester.ifsc_code),1)])):c("",!0),s.reject_reason?(i(),n("div",Vt,[t[22]||(t[22]=e("span",{class:"detail-label"},"Rejection Reason:",-1)),e("span",Dt,l(s.reject_reason),1)])):c("",!0),s.approve_date?(i(),n("div",Et,[t[23]||(t[23]=e("span",{class:"detail-label"},"Processed On:",-1)),e("span",Lt,l(h(s.approve_date)),1)])):c("",!0)]),e("div",Ft,[s.status==="pending"?(i(),n("button",{key:0,class:"btn-action btn-approve",onClick:R=>P(s.id,"approved")},t[24]||(t[24]=[e("i",{class:"fa-solid fa-check"},null,-1),j(" Approve ")]),8,St)):c("",!0),s.status==="pending"?(i(),n("button",{key:1,class:"btn-action btn-reject",onClick:R=>I(s.id)},t[25]||(t[25]=[e("i",{class:"fa-solid fa-times"},null,-1),j(" Reject ")]),8,Mt)):c("",!0),s.status!=="pending"?(i(),n("button",Bt,[t[26]||(t[26]=e("i",{class:"fa-solid fa-lock"},null,-1)),j(" "+l(s.status==="approved"?"Approved":"Rejected"),1)])):c("",!0)]),e("div",It,[e("div",{class:v(["timeline-item",{active:["pending","approved","rejected"].includes(s.status)}])},[t[28]||(t[28]=e("div",{class:"timeline-icon"},"ðŸ“",-1)),e("div",Tt,[t[27]||(t[27]=e("span",{class:"timeline-status"},"Request Submitted",-1)),e("span",Ut,l(h(s.created_at)),1)])],2),e("div",{class:v(["timeline-item",{active:["approved","rejected"].includes(s.status)}])},[e("div",Wt,l(s.status==="approved"?"âœ…":"âŒ"),1),e("div",zt,[e("span",Ot,l(s.status==="approved"?"Approved":"Rejected"),1),s.approve_date?(i(),n("span",Xt,l(h(s.approve_date)),1)):c("",!0)])],2)])],2))),128))]))]),C(g,{modelValue:_.value,"onUpdate:modelValue":t[6]||(t[6]=s=>_.value=s),title:"Reject Request","hide-footer":""},{default:Y(()=>[e("div",null,[C(p,{modelValue:f.value,"onUpdate:modelValue":t[4]||(t[4]=s=>f.value=s),placeholder:"Enter rejection reason",rows:"4",class:"w-100"},null,8,["modelValue"]),e("div",Gt,[e("button",{onClick:T,class:"btn-action btn-approve me-2"}," Confirm "),e("button",{onClick:t[5]||(t[5]=s=>_.value=!1),class:"btn-action btn-reject"}," Cancel ")])])]),_:1},8,["modelValue"]),k.value>1?(i(),n("div",Ht,[e("button",{onClick:O,disabled:d.value===1},t[29]||(t[29]=[e("i",{class:"fa-solid fa-chevron-left"},null,-1)]),8,Jt),e("span",null,"Page "+l(d.value)+" of "+l(k.value),1),e("button",{onClick:z,disabled:d.value===k.value},t[30]||(t[30]=[e("i",{class:"fa-solid fa-chevron-right"},null,-1)]),8,Kt)])):c("",!0),w.value?(i(),n("div",Qt,t[31]||(t[31]=[e("i",{class:"fa-solid fa-spinner fa-spin"},null,-1),j(" Loading requests... ")]))):c("",!0)])}}},se=X(Yt,[["__scopeId","data-v-c6c14dda"]]);export{se as default};
