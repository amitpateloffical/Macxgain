import{_ as b,c,o as d,b as s,h as k,t as l,n as u,i as p,F as f,r as _,j as v,v as S,M as O,W as M,w as y,X as g}from"./app-BFj7m03g.js";const w={name:"TrueDataStockMarket",data(){return{loading:!1,reconnecting:!1,isRefreshing:!1,marketStatus:"CLOSED",isMarketLive:!1,dataType:"UNKNOWN",dataSourceMessage:"",marketInfo:{trading_hours:"9:00 AM - 3:30 PM IST",trading_days:"Monday to Friday",next_session:""},lastUpdated:"",liveStocks:[],marketIndices:[],connectionStatus:{is_connected:!1,reconnect_attempts:0,subscribed_symbols_count:0,cached_data_count:0},searchQuery:"",sortBy:"symbol",toasts:[],toastId:0,showOptions:!1,selectedStock:null,callOptions:[],putOptions:[],optionsSearchQuery:"",filteredCallOptions:[],filteredPutOptions:[],filteredStrikes:[],loadingOptions:!1}},computed:{marketStatusClass(){return this.marketStatus==="OPEN"?"open":"closed"},marketStatusText(){return this.marketStatus==="OPEN"?"Market Open":"Market Closed"},connectionStatusClass(){return"connected"},connectionStatusText(){return this.marketStatus==="OPEN"?this.connectionStatus.cached_data_count>0?`ðŸ”¥ Live Data (${this.connectionStatus.cached_data_count} symbols)`:"Connected (Fetching Live Data...)":this.connectionStatus.cached_data_count>0?`ðŸ“Š Historical Data (${this.connectionStatus.cached_data_count} symbols)`:"Connected (API Ready)"},isConnected(){return this.connectionStatus.is_connected||this.marketStatus==="OPEN"},subscribedSymbolsCount(){return this.connectionStatus.subscribed_symbols_count},cachedDataCount(){return this.connectionStatus.cached_data_count},reconnectAttempts(){return this.connectionStatus.reconnect_attempts},filteredStocks(){let e=[...this.liveStocks];return this.searchQuery&&(e=e.filter(t=>t.symbol.toLowerCase().includes(this.searchQuery.toLowerCase()))),e.sort((t,a)=>{switch(this.sortBy){case"symbol":return t.symbol.localeCompare(a.symbol);case"last":return a.last-t.last;case"change_percent":return a.change_percent-t.change_percent;case"volume":return a.volume-t.volume;default:return 0}}),e}},mounted(){this.marketStatus="CLOSED",this.loadMarketData(),this.startAutoRefresh(),document.addEventListener("keydown",this.handleKeyPress)},beforeUnmount(){this.stopAutoRefresh(),document.removeEventListener("keydown",this.handleKeyPress)},methods:{async loadMarketData(){var e;this.loading=!0,this.isRefreshing=!0,console.log("ðŸ“Š Loading TrueData live market data at:",new Date().toLocaleTimeString());try{const t=localStorage.getItem("access_token");console.log("Token:",t?"Present":"Missing"),console.log("ðŸ”„ Loading live data from Python script...");const a=await g.get("/api/truedata/live-data",{headers:{Accept:"application/json"},params:{_t:Date.now()}});if(console.log("âœ… TrueData Live Data API Response:",a.data),console.log("ðŸ“ˆ Response status:",a.status),console.log("ðŸ”¢ Data keys count:",Object.keys(a.data.data||{}).length),a.data.success&&a.data.data&&Object.keys(a.data.data).length>0){const r=a.data.data;console.log("ðŸŽ¯ Live data received:",Object.keys(r).length,"symbols"),console.log("Processing Live Data:",r),console.log("Data count:",a.data.data_count),console.log("Last update:",a.data.last_update),this.marketStatus=((e=a.data.market_status)==null?void 0:e.status)||"CLOSED",this.isMarketLive=a.data.is_market_live||!1,this.dataType=a.data.data_type||"UNKNOWN",this.dataSourceMessage=a.data.data_source||"",this.marketInfo={trading_hours:"9:15 AM - 3:30 PM IST",trading_days:"Monday to Friday",next_session:""},this.liveStocks=this.formatStockData(r),this.connectionStatus.cached_data_count=Object.keys(r).length,this.connectionStatus.is_connected=!0,console.log("Live stocks processed:",this.liveStocks);const i=["NIFTY 50","NIFTY BANK","SENSEX","FINNIFTY","NIFTY MIDCAP"];this.marketIndices=i.filter(n=>r[n]).map(n=>{const h=r[n];return{symbol:h.symbol,last:h.ltp||0,change:h.change||0,change_percent:h.change_percent||0,volume:h.volume||0,high:h.high||0,low:h.low||0,open:h.open||0,prev_close:h.prev_close||0,timestamp:h.timestamp||new Date().toISOString()}}),console.log("Market indices processed:",this.marketIndices),this.lastUpdated=a.data.last_update||new Date().toLocaleTimeString(),this.showSuccess(`Live market data loaded! ${Object.keys(r).length} symbols updated`)}else console.log("No live data available, trying dashboard fallback for historical data..."),a.data.market_status?(this.marketStatus=a.data.market_status.status||"CLOSED",this.marketInfo={trading_hours:a.data.market_status.trading_hours||"9:15 AM - 3:30 PM IST",trading_days:"Monday to Friday",next_session:a.data.market_status.next_open||"Next session: Tomorrow 9:15 AM"}):this.marketStatus="CLOSED",await this.loadDashboardFallback(),this.liveStocks.length===0&&this.showWarning("Market data is being fetched. Please wait a moment and refresh the page.")}catch(t){console.error("Error loading TrueData market data:",t),this.connectionStatus.is_connected=!1,this.showError("Failed to load market data. Please try again.")}finally{this.loading=!1}},async loadMarketStatus(){try{const e=localStorage.getItem("access_token"),t=await g.get("/api/truedata/market-status",{headers:{Authorization:`Bearer ${e}`,Accept:"application/json"}});if(t.data.success){const a=t.data.data;this.marketStatus=a.market_status||"CLOSED",this.marketInfo={trading_hours:a.trading_hours||"9:00 AM - 3:30 PM IST",trading_days:a.trading_days||"Monday to Friday",next_session:a.next_session||""}}}catch(e){console.error("Error loading market status:",e)}},async loadTopGainers(){try{const e=localStorage.getItem("access_token"),t=await g.get("/api/truedata/top-gainers",{headers:{Authorization:`Bearer ${e}`,Accept:"application/json"}});t.data.success&&(this.topGainers=t.data.data||[])}catch(e){console.error("Error loading top gainers:",e)}},async loadTopLosers(){try{const e=localStorage.getItem("access_token"),t=await g.get("/api/truedata/top-losers",{headers:{Authorization:`Bearer ${e}`,Accept:"application/json"}});t.data.success&&(this.topLosers=t.data.data||[])}catch(e){console.error("Error loading top losers:",e)}},formatStockData(e){return!e||typeof e!="object"?[]:Object.values(e).map(t=>({symbol:t.symbol||"",last:t.ltp||t.last||0,open:t.open||0,high:t.high||0,low:t.low||0,prev_close:t.prev_close||0,change:t.change||0,change_percent:t.change_percent||0,volume:t.volume||0,bid:t.bid||0,ask:t.ask||0,last_time:t.last_time||t.timestamp||""}))},updateStockData(e){const t=this.liveStocks.findIndex(a=>a.symbol===e.symbol);t!==-1?this.liveStocks[t]={...this.liveStocks[t],...e,last_time:new Date().toISOString()}:this.liveStocks.push({symbol:e.symbol,last:e.last||0,open:e.open||0,high:e.high||0,low:e.low||0,prev_close:e.prev||0,change:(e.last||0)-(e.prev||0),change_percent:e.prev>0?((e.last||0)-(e.prev||0))/e.prev*100:0,volume:e.volume||0,bid:e.bid||0,ask:e.ask||0,last_time:new Date().toISOString()})},async refreshStockData(){await this.loadMarketData()},async refreshGainers(){await this.loadTopGainers()},async refreshLosers(){await this.loadTopLosers()},async refreshStatus(){await this.loadMarketStatus()},async reconnect(){this.reconnecting=!0;try{await this.loadMarketData(),this.showSuccess("Data refreshed successfully!")}catch(e){console.error("Reconnection error:",e),this.connectionStatus.is_connected=!1,this.showError("Failed to refresh data. Please try again.")}finally{this.reconnecting=!1}},startAutoRefresh(){this.autoRefreshInterval=setInterval(()=>{console.log("ðŸ”„ Auto-refresh triggered at:",new Date().toLocaleTimeString(),"Market status:",this.marketStatus),this.loadMarketData()},1e4)},stopAutoRefresh(){this.autoRefreshInterval&&clearInterval(this.autoRefreshInterval)},formatNumber(e){return e==null?"0":new Intl.NumberFormat("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e)},navigateTo(e){this.$router.push(e)},showError(e){this.addToast("error","Error",e,"fas fa-exclamation-circle")},showSuccess(e){this.addToast("success","Success",e,"fas fa-check-circle")},showInfo(e){this.addToast("info","Info",e,"fas fa-info-circle")},showWarning(e){this.addToast("warning","Warning",e,"fas fa-exclamation-triangle")},addToast(e,t,a,r){const i={id:++this.toastId,type:e,title:t,message:a,icon:r};this.toasts.push(i),setTimeout(()=>{this.removeToast(i.id)},5e3)},removeToast(e){const t=this.toasts.findIndex(a=>a.id===e);t>-1&&this.toasts.splice(t,1)},async refreshData(){this.loading=!0;try{await this.loadMarketData(),this.showSuccess("Market data refreshed successfully!")}catch{this.showError("Failed to refresh data. Please try again.")}finally{this.loading=!1}},async searchAndAddStock(){if(!this.searchQuery.trim()){this.showWarning("Please enter a stock symbol to search");return}try{this.loading=!0,console.log("Searching for stock:",this.searchQuery);const e=localStorage.getItem("access_token"),t=await g.post("/api/truedata/search-stock",{symbol:this.searchQuery.trim().toUpperCase()},{headers:{Authorization:`Bearer ${e}`,Accept:"application/json","Content-Type":"application/json"}});if(console.log("Search stock response:",t.data),t.data.success&&t.data.data){const a=t.data.data;if(this.liveStocks.find(n=>n.symbol===a.symbol)){this.showInfo(`Stock ${a.symbol} is already in the list`),this.searchQuery="";return}const i={symbol:a.symbol,price:a.ltp||a.last||0,change:a.change||0,change_percent:a.change_percent||0,volume:a.volume||0,high:a.high||0,low:a.low||0,open:a.open||0,prev_close:a.prev_close||0,timestamp:a.timestamp||new Date().toISOString()};this.liveStocks.unshift(i),this.connectionStatus.cached_data_count=this.liveStocks.length,this.showSuccess(`Stock ${a.symbol} added successfully!`),this.searchQuery=""}else this.showError(t.data.message||"Stock not found or data unavailable")}catch(e){console.error("Error searching for stock:",e),this.showError("Failed to search for stock. Please try again.")}finally{this.loading=!1}},async triggerDataFetch(){try{if(!this.isMarketLive){this.showError("Market is closed. Historical data is already cached and will not refresh.");return}(await g.post("/api/truedata/trigger-fetch",{},{headers:{Accept:"application/json"}})).data.success&&(console.log("Live data fetch triggered successfully"),this.showSuccess("Live data fetch triggered successfully"),setTimeout(()=>{this.loadMarketData()},3e3))}catch(e){console.error("Error triggering data fetch:",e),this.showError("Failed to trigger data fetch")}},async loadDashboardFallback(){try{console.log("Loading dashboard fallback data...");const e=await g.get("/api/truedata/dashboard",{headers:{Accept:"application/json"},params:{_t:Date.now()}});if(console.log("Dashboard fallback response:",e.data),e.data.success){const t=e.data.data;if(t.quotes&&Object.keys(t.quotes).length>0&&(this.liveStocks=this.formatStockData(t.quotes),this.connectionStatus.cached_data_count=Object.keys(t.quotes).length,this.connectionStatus.is_connected=!0,console.log("Dashboard stocks processed:",this.liveStocks.length)),t.indices&&Object.keys(t.indices).length>0){const a=["NIFTY 50","NIFTY BANK","SENSEX","FINNIFTY","NIFTY MIDCAP"];this.marketIndices=a.filter(r=>t.indices[r]).map(r=>{const i=t.indices[r];return{symbol:i.symbol,last:i.ltp||i.last||0,change:i.change||0,change_percent:i.change_percent||0,volume:i.volume||0,high:i.high||0,low:i.low||0,open:i.open||0,prev_close:i.prev_close||0,timestamp:i.timestamp||new Date().toISOString()}}),console.log("Dashboard indices processed:",this.marketIndices.length)}this.lastUpdated=new Date().toLocaleTimeString(),this.showInfo("Using historical data (Market closed)")}else console.log("Dashboard fallback also failed, showing empty state"),this.connectionStatus.is_connected=!1,this.connectionStatus.cached_data_count=0,this.showWarning("No market data available. Market is closed and no historical data found.")}catch(e){console.error("Dashboard fallback failed:",e),this.connectionStatus.is_connected=!1,this.connectionStatus.cached_data_count=0,this.showError("Failed to load market data from both live and historical sources.")}},async loadMarketStatus(){try{const e=await g.get("/api/truedata/market-status",{headers:{Accept:"application/json"}});e.data.success&&(this.marketStatus=e.data.data.status,this.marketInfo={trading_hours:e.data.data.trading_hours||"9:15 AM - 3:30 PM IST",trading_days:"Monday to Friday",next_session:e.data.data.next_open||e.data.data.next_change||""})}catch(e){console.error("Error loading market status:",e),this.marketStatus="UNKNOWN",this.marketInfo={trading_hours:"9:15 AM - 3:30 PM IST",trading_days:"Monday to Friday",next_session:""}}},getMarketStatusText(){switch(this.marketStatus){case"OPEN":return"ðŸŸ¢ Market LIVE";case"PRE_OPEN":return"ðŸŸ¡ Pre-Market";case"POST_CLOSE":return"ðŸŸ¡ Post-Market";case"CLOSED":return"ðŸ”´ Market CLOSED";default:return"âšª Status Unknown"}},getMarketStatusClass(){switch(this.marketStatus){case"OPEN":return"live";case"PRE_OPEN":case"POST_CLOSE":return"pre-open";case"CLOSED":return"closed";default:return"unknown"}},async showOptionsModal(e,t){console.log("ðŸŽ¯ showOptionsModal called with:",e,t),this.selectedStock={symbol:e,...t},this.showOptions=!0,this.loadingOptions=!0;try{console.log("ðŸ”„ About to call loadOptionsData for:",e),await this.loadOptionsData(e),console.log("âœ… loadOptionsData completed for:",e)}catch(a){console.error("âŒ Error in showOptionsModal:",a)}finally{this.loadingOptions=!1}},closeOptionsModal(){this.showOptions=!1,this.selectedStock=null,this.callOptions=[],this.putOptions=[]},async loadOptionsData(e){var t;try{if(console.log(`ðŸ”„ Loading options data for ${e}`),console.log(`ðŸŒ API URL: /api/truedata/options/chain/${encodeURIComponent(e)}`),e==="SENSEX"){this.showError("SENSEX options are not actively traded. Please try NIFTY 50 or NIFTY BANK for options trading."),this.closeOptionsModal();return}const a=await g.get(`/api/truedata/options/chain/${encodeURIComponent(e)}`);console.log("ðŸ“¡ Options API response:",a),console.log("ðŸ“Š Response data:",a.data),console.log("âœ… Response status:",a.status),a.data.success&&a.data.data?(console.log("ðŸŽ¯ Processing real API data..."),this.processOptionsData(a.data.data)):(console.log("âš ï¸ API response not successful, using mock data"),console.log("Response success:",a.data.success),console.log("Response data exists:",!!a.data.data),this.generateMockOptions(e))}catch(a){console.error("âŒ Error loading options data:",a),console.error("Error details:",((t=a.response)==null?void 0:t.data)||a.message),console.log("ðŸ”„ Using mock data as fallback"),this.generateMockOptions(e)}},processOptionsData(e){console.log("ðŸ”„ Processing options data:",e),console.log("ðŸ“Š Data length:",e.length);const t=[],a=[];e.forEach((r,i)=>{console.log(`Processing option ${i+1}:`,r);const n={strike:r.strike_price,price:r.ltp,volume:r.volume,oi:r.oi,bid:r.bid,ask:r.ask,bid_qty:r.bid_qty,ask_qty:r.ask_qty,greeks:{delta:r.delta||0,gamma:r.gamma||0,theta:r.theta||0,vega:r.vega||0}};r.option_type==="CALL"?(t.push(n),console.log("âœ… Added CALL option:",n)):r.option_type==="PUT"?(a.push(n),console.log("âœ… Added PUT option:",n)):console.log("âš ï¸ Unknown option type:",r.option_type)}),t.sort((r,i)=>r.strike-i.strike),a.sort((r,i)=>r.strike-i.strike),this.callOptions=t,this.putOptions=a,this.filteredCallOptions=[...this.callOptions],this.filteredPutOptions=[...this.putOptions],this.filteredStrikes=[...new Set([...t.map(r=>r.strike),...a.map(r=>r.strike)])].sort((r,i)=>r-i),this.optionsSearchQuery="",console.log(`ðŸŽ¯ Processed ${t.length} CALL options and ${a.length} PUT options`),console.log("ðŸ“ˆ Final callOptions:",this.callOptions),console.log("ðŸ“‰ Final putOptions:",this.putOptions)},generateMockOptions(e){var r,i;console.log("ðŸ”„ Generating mock options for:",e);const t=((r=this.selectedStock)==null?void 0:r.last)||((i=this.selectedStock)==null?void 0:i.ltp)||1e3;console.log("ðŸ’° Current price for mock data:",t);const a=this.generateStrikes(t);console.log("ðŸŽ¯ Generated strikes:",a),this.callOptions=a.map(n=>({strike:n,price:this.calculateOptionPrice(t,n,"call"),volume:Math.floor(Math.random()*1e4),oi:Math.floor(Math.random()*5e4),greeks:{delta:(Math.random()*.8+.1).toFixed(3),gamma:(Math.random()*.1).toFixed(3),theta:(-Math.random()*5).toFixed(3),vega:(Math.random()*10).toFixed(3)}})),this.putOptions=a.map(n=>({strike:n,price:this.calculateOptionPrice(t,n,"put"),volume:Math.floor(Math.random()*1e4),oi:Math.floor(Math.random()*5e4),greeks:{delta:(-Math.random()*.8-.1).toFixed(3),gamma:(Math.random()*.1).toFixed(3),theta:(-Math.random()*5).toFixed(3),vega:(Math.random()*10).toFixed(3)}})),this.filteredCallOptions=[...this.callOptions],this.filteredPutOptions=[...this.putOptions],this.filteredStrikes=a,this.optionsSearchQuery=""},generateStrikes(e){const t=[],a=Math.round(e*.02),r=Math.round(e-5*a),i=Math.round(e+5*a);for(let n=r;n<=i;n+=a)t.push(n);return t},calculateOptionPrice(e,t,a){const r=a==="call"?Math.max(0,e-t):Math.max(0,t-e),i=Math.max(1,e*(.008+Math.random()*.004));return(r+i).toFixed(2)},handleKeyPress(e){e.key==="Escape"&&this.showOptions&&this.closeOptionsModal()},filterOptions(){if(!this.optionsSearchQuery){this.filteredCallOptions=[...this.callOptions],this.filteredPutOptions=[...this.putOptions],this.filteredStrikes=this.callOptions.map(r=>r.strike);return}const e=this.optionsSearchQuery.toLowerCase();this.filteredCallOptions=this.callOptions.filter(r=>r.strike.toString().includes(e)),this.filteredPutOptions=this.putOptions.filter(r=>r.strike.toString().includes(e));const t=this.filteredCallOptions.map(r=>r.strike),a=this.filteredPutOptions.map(r=>r.strike);this.filteredStrikes=[...new Set([...t,...a])].sort((r,i)=>r-i)},getStrikeIndicatorClass(e){var a;const t=((a=this.selectedStock)==null?void 0:a.last)||0;return e<t?"itm":e>t?"otm":"atm"},getStrikeIndicatorText(e){var a;const t=((a=this.selectedStock)==null?void 0:a.last)||0;return e<t?"ITM":e>t?"OTM":"ATM"}}},I={class:"stock-market-screen"},C={class:"page-header"},P={class:"header-content"},T={class:"header-left"},D={class:"header-info"},L={class:"page-subtitle"},E={class:"header-right"},A=["disabled","title"],N=["disabled"],x={key:0,class:"refresh-indicator"},F={class:"market-info"},R={class:"market-status"},U={class:"status-text"},j={class:"trading-hours"},Q={class:"trading-days"},B={key:0,class:"next-session"},V={class:"last-updated"},K={key:0},Y={key:1},W=["disabled"],q={class:"indices-section"},G={class:"indices-grid"},z={class:"index-name"},H={class:"index-price"},X={class:"index-change"},J={class:"change-value"},Z={class:"change-percent"},$={class:"main-content"},tt={class:"stocks-section"},st={class:"section-header"},et={class:"section-title"},at={class:"stock-count"},ot=["disabled"],it={class:"filters-section"},nt={class:"filter-group"},rt={class:"search-input-wrapper"},lt=["disabled"],ct={class:"filter-group"},dt={key:0,class:"stocks-grid"},ht=["onClick"],ut={class:"stock-header"},pt={class:"stock-symbol"},gt={class:"stock-price"},kt={class:"stock-details"},mt={class:"stock-change"},ft={class:"change-value"},_t={class:"change-percent"},vt={class:"stock-volume"},St={class:"stock-ohlc"},yt={class:"ohlc-item"},bt={class:"ohlc-value"},Ot={class:"ohlc-item"},Mt={class:"ohlc-value"},wt={class:"ohlc-item"},It={class:"ohlc-value"},Ct={key:1,class:"empty-state"},Pt={class:"empty-state-actions"},Tt={class:"toast-container"},Dt=["onClick"],Lt={class:"toast-icon"},Et={class:"toast-content"},At={class:"toast-title"},Nt={class:"toast-message"},xt=["onClick"],Ft={class:"options-header"},Rt={class:"header-actions"},Ut={class:"search-container"},jt={class:"options-content"},Qt={key:0,class:"options-loading"},Bt={key:1,class:"options-comparison"},Vt={class:"options-column put-column"},Kt={class:"options-list"},Yt={class:"option-strike"},Wt={class:"option-price"},qt={class:"option-details"},Gt={class:"option-volume"},zt={class:"option-oi"},Ht={key:0,class:"option-greeks"},Xt={class:"greeks-row"},Jt={class:"greek"},Zt={class:"greek"},$t={class:"greeks-row"},ts={class:"greek"},ss={class:"greek"},es={class:"strike-column"},as={class:"strike-list"},os={class:"strike-price"},is={class:"options-column call-column"},ns={class:"options-list"},rs={class:"option-strike"},ls={class:"option-price"},cs={class:"option-details"},ds={class:"option-volume"},hs={class:"option-oi"},us={key:0,class:"option-greeks"},ps={class:"greeks-row"},gs={class:"greek"},ks={class:"greek"},ms={class:"greeks-row"},fs={class:"greek"},_s={class:"greek"};function vs(e,t,a,r,i,n){var h;return d(),c(f,null,[s("div",I,[s("div",C,[s("div",P,[s("div",T,[s("button",{class:"back-btn",onClick:t[0]||(t[0]=o=>n.navigateTo("/admin/dashboard"))},t[15]||(t[15]=[s("i",{class:"fas fa-arrow-left"},null,-1)])),s("div",D,[t[16]||(t[16]=s("h1",{class:"page-title"},"ðŸ“ˆ Stock Market",-1)),s("p",L,l(i.dataSourceMessage||(i.marketStatus==="OPEN"?"ðŸ”¥ Live market data powered by TrueData Python Script":"ðŸ“Š Last available data (Market Closed)")),1)])]),s("div",E,[s("div",{class:u(["market-status",n.marketStatusClass])},[t[17]||(t[17]=s("div",{class:"status-indicator"},null,-1)),s("span",null,l(n.marketStatusText),1)],2),s("button",{onClick:t[1]||(t[1]=(...o)=>n.triggerDataFetch&&n.triggerDataFetch(...o)),disabled:i.loading,class:"fetch-btn",title:i.isMarketLive?"Fetch fresh live data from Python script":"Market closed - Historical data cached"},[s("i",{class:u(["fas fa-download",{"fa-spin":i.loading}])},null,2),p(" "+l(i.loading?"Fetching...":i.isMarketLive?"Fetch Live Data":"Historical Data"),1)],8,A),s("button",{onClick:t[2]||(t[2]=(...o)=>n.refreshData&&n.refreshData(...o)),disabled:i.loading,class:"refresh-btn",title:"Refresh current data"},[s("i",{class:u(["fas fa-sync-alt",{"fa-spin":i.isRefreshing}])},null,2),p(" "+l(i.isRefreshing?"Refreshing...":"Refresh"),1)],8,N),i.isRefreshing?(d(),c("div",x,t[18]||(t[18]=[s("i",{class:"fas fa-circle-notch fa-spin"},null,-1),s("span",null,"Auto-refreshing data...",-1)]))):k("",!0),s("div",F,[s("div",R,[s("span",{class:u(["status-dot",n.getMarketStatusClass()])},null,2),s("span",U,l(n.getMarketStatusText()),1)]),s("div",j,l(i.marketInfo.trading_hours),1),s("div",Q,l(i.marketInfo.trading_days),1),i.marketInfo.next_session&&i.marketStatus==="CLOSED"?(d(),c("div",B,[t[19]||(t[19]=s("i",{class:"fas fa-clock"},null,-1)),p(" "+l(i.marketInfo.next_session),1)])):k("",!0)]),s("div",V,[i.marketStatus==="OPEN"?(d(),c("span",K,"Last updated: "+l(i.lastUpdated),1)):(d(),c("span",Y,"Last trading data: "+l(i.lastUpdated),1))])])])]),s("div",{class:u(["connection-status",n.connectionStatusClass])},[t[21]||(t[21]=s("div",{class:"status-indicator"},null,-1)),s("span",null,l(n.connectionStatusText),1),n.isConnected?k("",!0):(d(),c("button",{key:0,class:"reconnect-btn",onClick:t[3]||(t[3]=(...o)=>n.reconnect&&n.reconnect(...o)),disabled:i.reconnecting},[s("i",{class:u(["fas fa-sync-alt",{"fa-spin":i.reconnecting}])},null,2),t[20]||(t[20]=p(" Reconnect "))],8,W))],2),s("div",q,[t[22]||(t[22]=s("h2",{class:"section-title"},"Market Indices",-1)),s("div",G,[(d(!0),c(f,null,_(i.marketIndices,o=>{var m;return d(),c("div",{key:o.symbol,class:u(["index-card",{positive:o.change>0,negative:o.change<0}])},[s("div",z,l(o.symbol),1),s("div",H,"â‚¹"+l(n.formatNumber(o.last)),1),s("div",X,[s("span",J,l(o.change>0?"+":"")+l(n.formatNumber(o.change)),1),s("span",Z,"("+l(o.change_percent>0?"+":"")+l((m=o.change_percent)==null?void 0:m.toFixed(2))+"%)",1)])],2)}),128))])]),s("div",$,[s("div",tt,[s("div",st,[s("div",et,[t[23]||(t[23]=s("i",{class:"fas fa-chart-line"},null,-1)),t[24]||(t[24]=s("h3",null,"Live Stock Prices",-1)),s("span",at,"("+l(n.filteredStocks.length)+" stocks)",1)]),s("button",{class:"refresh-btn",onClick:t[4]||(t[4]=(...o)=>n.refreshStockData&&n.refreshStockData(...o)),disabled:i.loading},[s("i",{class:u(["fas fa-sync-alt",{"fa-spin":i.loading}])},null,2),t[25]||(t[25]=p(" Refresh "))],8,ot)]),s("div",it,[s("div",nt,[t[28]||(t[28]=s("label",{class:"filter-label"},"Search:",-1)),s("div",rt,[t[27]||(t[27]=s("i",{class:"fas fa-search search-icon"},null,-1)),v(s("input",{"onUpdate:modelValue":t[5]||(t[5]=o=>i.searchQuery=o),type:"text",placeholder:"Search stocks...",class:"filter-input",onKeyup:t[6]||(t[6]=O((...o)=>n.searchAndAddStock&&n.searchAndAddStock(...o),["enter"]))},null,544),[[S,i.searchQuery]]),s("button",{class:"search-btn",onClick:t[7]||(t[7]=(...o)=>n.searchAndAddStock&&n.searchAndAddStock(...o)),disabled:i.loading||!i.searchQuery.trim(),title:"Search and add stock"},t[26]||(t[26]=[s("i",{class:"fas fa-plus"},null,-1)]),8,lt)])]),s("div",ct,[t[30]||(t[30]=s("label",{class:"filter-label"},"Sort by:",-1)),v(s("select",{"onUpdate:modelValue":t[8]||(t[8]=o=>i.sortBy=o),class:"filter-select"},t[29]||(t[29]=[s("option",{value:"symbol"},"Symbol",-1),s("option",{value:"last"},"Price",-1),s("option",{value:"change_percent"},"Change %",-1),s("option",{value:"volume"},"Volume",-1)]),512),[[M,i.sortBy]])])]),n.filteredStocks.length>0?(d(),c("div",dt,[(d(!0),c(f,null,_(n.filteredStocks,o=>{var m;return d(),c("div",{key:o.symbol,class:u(["stock-card",{positive:o.change>0,negative:o.change<0}]),onClick:Ss=>n.showOptionsModal(o.symbol,o),style:{cursor:"pointer"}},[s("div",ut,[s("div",pt,l(o.symbol),1),s("div",gt,"â‚¹"+l(n.formatNumber(o.last)),1)]),s("div",kt,[s("div",mt,[s("span",ft,l(o.change>0?"+":"")+l(n.formatNumber(o.change)),1),s("span",_t,"("+l(o.change_percent>0?"+":"")+l((m=o.change_percent)==null?void 0:m.toFixed(2))+"%)",1)]),s("div",vt,"Vol: "+l(n.formatNumber(o.volume)),1)]),s("div",St,[s("div",yt,[t[31]||(t[31]=s("span",{class:"ohlc-label"},"O:",-1)),s("span",bt,"â‚¹"+l(n.formatNumber(o.open)),1)]),s("div",Ot,[t[32]||(t[32]=s("span",{class:"ohlc-label"},"H:",-1)),s("span",Mt,"â‚¹"+l(n.formatNumber(o.high)),1)]),s("div",wt,[t[33]||(t[33]=s("span",{class:"ohlc-label"},"L:",-1)),s("span",It,"â‚¹"+l(n.formatNumber(o.low)),1)])])],10,ht)}),128))])):k("",!0),n.filteredStocks.length===0?(d(),c("div",Ct,[t[35]||(t[35]=s("div",{class:"empty-state-icon"},[s("i",{class:"fas fa-chart-line"})],-1)),t[36]||(t[36]=s("div",{class:"empty-state-title"},"No Market Data Available",-1)),t[37]||(t[37]=s("div",{class:"empty-state-message"},[p(" Market is currently closed. Real-time data will be available during trading hours:"),s("br"),s("strong",null,"9:00 AM - 3:30 PM IST (Monday to Friday)")],-1)),s("div",Pt,[s("button",{onClick:t[9]||(t[9]=(...o)=>n.loadMarketData&&n.loadMarketData(...o)),class:"retry-btn"},t[34]||(t[34]=[s("i",{class:"fas fa-sync-alt"},null,-1),p(" Try Again ")]))])])):k("",!0)])])]),s("div",Tt,[(d(!0),c(f,null,_(i.toasts,o=>(d(),c("div",{key:o.id,class:u(["toast",o.type]),onClick:m=>n.removeToast(o.id)},[s("div",Lt,[s("i",{class:u(o.icon)},null,2)]),s("div",Et,[s("div",At,l(o.title),1),s("div",Nt,l(o.message),1)]),s("button",{class:"toast-close",onClick:y(m=>n.removeToast(o.id),["stop"])},t[38]||(t[38]=[s("i",{class:"fas fa-times"},null,-1)]),8,xt)],10,Dt))),128))]),i.showOptions?(d(),c("div",{key:0,class:"options-modal-overlay",onClick:t[14]||(t[14]=(...o)=>n.closeOptionsModal&&n.closeOptionsModal(...o))},[s("div",{class:"options-modal",onClick:t[13]||(t[13]=y(()=>{},["stop"]))},[s("div",Ft,[s("h3",null,l((h=i.selectedStock)==null?void 0:h.symbol)+" Options",1),s("div",Rt,[s("div",Ut,[v(s("input",{"onUpdate:modelValue":t[10]||(t[10]=o=>i.optionsSearchQuery=o),type:"text",placeholder:"Search by strike price...",class:"options-search",onInput:t[11]||(t[11]=(...o)=>n.filterOptions&&n.filterOptions(...o))},null,544),[[S,i.optionsSearchQuery]]),t[39]||(t[39]=s("i",{class:"fas fa-search search-icon"},null,-1))]),t[41]||(t[41]=s("span",{class:"esc-hint"},"Press ESC to close",-1)),s("button",{onClick:t[12]||(t[12]=(...o)=>n.closeOptionsModal&&n.closeOptionsModal(...o)),class:"close-btn"},t[40]||(t[40]=[s("i",{class:"fas fa-times"},null,-1)]))])]),s("div",jt,[i.loadingOptions?(d(),c("div",Qt,t[42]||(t[42]=[s("div",{class:"loading-spinner"},[s("i",{class:"fas fa-circle-notch fa-spin"})],-1),s("p",null,"Loading options data...",-1)]))):(d(),c("div",Bt,[s("div",Vt,[t[43]||(t[43]=s("h4",{class:"section-title put-title"},[s("i",{class:"fas fa-arrow-down"}),p(" Put Options ")],-1)),s("div",Kt,[(d(!0),c(f,null,_(i.filteredPutOptions,o=>(d(),c("div",{key:o.strike,class:"option-row put-option"},[s("div",Yt,l(o.strike),1),s("div",Wt,"â‚¹"+l(o.price||"--"),1),s("div",qt,[s("div",Gt,"Vol: "+l(o.volume||"--"),1),s("div",zt,"OI: "+l(o.oi||"--"),1)]),o.greeks?(d(),c("div",Ht,[s("div",Xt,[s("span",Jt,"Î” "+l(o.greeks.delta||"--"),1),s("span",Zt,"Î“ "+l(o.greeks.gamma||"--"),1)]),s("div",$t,[s("span",ts,"Î˜ "+l(o.greeks.theta||"--"),1),s("span",ss,"Î½ "+l(o.greeks.vega||"--"),1)])])):k("",!0)]))),128))])]),s("div",es,[t[44]||(t[44]=s("h4",{class:"section-title strike-title"},[s("i",{class:"fas fa-bullseye"}),p(" Strike Price ")],-1)),s("div",as,[(d(!0),c(f,null,_(i.filteredStrikes,o=>(d(),c("div",{key:o,class:"strike-row"},[s("div",os,l(o),1),s("div",{class:u(["strike-indicator",n.getStrikeIndicatorClass(o)])},l(n.getStrikeIndicatorText(o)),3)]))),128))])]),s("div",is,[t[45]||(t[45]=s("h4",{class:"section-title call-title"},[s("i",{class:"fas fa-arrow-up"}),p(" Call Options ")],-1)),s("div",ns,[(d(!0),c(f,null,_(i.filteredCallOptions,o=>(d(),c("div",{key:o.strike,class:"option-row call-option"},[s("div",rs,l(o.strike),1),s("div",ls,"â‚¹"+l(o.price||"--"),1),s("div",cs,[s("div",ds,"Vol: "+l(o.volume||"--"),1),s("div",hs,"OI: "+l(o.oi||"--"),1)]),o.greeks?(d(),c("div",us,[s("div",ps,[s("span",gs,"Î” "+l(o.greeks.delta||"--"),1),s("span",ks,"Î“ "+l(o.greeks.gamma||"--"),1)]),s("div",ms,[s("span",fs,"Î˜ "+l(o.greeks.theta||"--"),1),s("span",_s,"Î½ "+l(o.greeks.vega||"--"),1)])])):k("",!0)]))),128))])])]))])])])):k("",!0)],64)}const bs=b(w,[["render",vs],["__scopeId","data-v-fbb2acba"]]);export{bs as default};
