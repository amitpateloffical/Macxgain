/* empty css                   */import{_ as F,g as c,Y as T,c as m,o as n,b as d,h as p,l,t as f,Q as v,j as W,q as s,i as h,F as D,w as N,s as b,f as k}from"./app-Da8Q9-cl.js";import{C as z}from"./vue-select.es-Bd10goMl.js";const H={components:{vSelect:z},data(){return{errors:{},showfilter:!1,fetchRequests:[],fields:[{key:"amount",label:"Amount",sortable:!0},{key:"description",label:"Description"},{key:"status",label:"Status",sortable:!0},{key:"request_create_for",label:"Recipient",formatter:(t,e,r)=>r.recipient.name},{key:"created_at",label:"Request Date",sortable:!0,formatter:t=>new Date(t).toLocaleString()},{key:"actions",label:"Actions"}],requestData:{transaction_id:"",amount:"",description:"",image:null,request_create_for:null,image_path:null},showRequestModal:!1,showImageModal:!1,showRejectModal:!1,isEdit:!1,loading:!1,successMessage:"",statusOptions:[{value:"pending",text:"Pending"},{value:"approved",text:"Approved"},{value:"rejected",text:"Rejected"}],userOptions:[],totalrows:0,sortBy:"",sortDesc:!0,modalLoading:!1,editmodalLoading:!1,imagePreviewUrl:"",currentEditId:null,currentRequestToReject:null,rejectReason:"",isAdmin:!1,currentUserId:null,canWithdraw:!1,availableBalance:0,errorMessage:""}},computed:{rangeStart(){return this.totalrows===0?0:(this.currentPage-1)*this.perPage+1},rangeEnd(){return this.currentPage*this.perPage>=this.totalrows?this.totalrows:this.currentPage*this.perPage}},setup(){const t=k({transaction_id:"",status:null,recipient:null,from_date:null,to_date:null}),e=k(1),r=k(10);return{search:t,currentPage:e,perPage:r,perPageOptions:[10,25,50,100]}},mounted(){this.fetchUserInfo(),this.fetchRequestss(),this.fetchUsers()},methods:{fetchUserInfo(){b.get("/user-info").then(t=>{this.isAdmin=t.data.is_admin,this.currentUserId=t.data.id}).catch(t=>{console.error(t)})},getStatusVariant(t){switch(t){case"approved":return"success";case"rejected":return"danger";default:return"warning"}},fetchRequestss(){this.modalLoading=!0,b.get("/withdrawal-request",{params:{page:this.currentPage,perPage:this.perPage,sortBy:this.sortBy,sortDesc:this.sortDesc,...this.search}}).then(t=>{this.fetchRequests=t.data.data,this.totalrows=t.data.total,this.modalLoading=!1}).catch(t=>{console.error(t),this.modalLoading=!1})},fetchUsers(){b.get("/users").then(t=>{this.userOptions=t.data}).catch(t=>{console.error(t)})},openRequestModal(t=null){this.showRequestModal=!0,this.modalLoading=!0,this.canWithdraw=!1,b.get("/checkBankInfo").then(e=>{e.data.status==="success"?(this.availableBalance=e.data.data.balance,this.canWithdraw=!0):(this.errorMessage=e.data.message,this.canWithdraw=!1)}).catch(e=>{var r,i;this.errorMessage=((i=(r=e.response)==null?void 0:r.data)==null?void 0:i.message)||"Something went wrong!",this.canWithdraw=!1}).finally(()=>{this.modalLoading=!1}),this.isEdit=!!t,this.currentEditId=t,t?(this.editmodalLoading=!0,b.get(`/withdrawal-request/${t}`).then(e=>{const r=e.data.data;this.requestData.transaction_id=r.transaction_id,this.requestData.amount=r.amount,this.requestData.description=r.description,this.requestData.image_path=r.image_path,this.requestData.image=r.image,this.editmodalLoading=!1}).catch(e=>{console.error(e),this.editmodalLoading=!1})):this.requestData={transaction_id:"",amount:"",description:"",image:null,request_create_for:null,image_path:null}},submitRequest(){this.loading=!0;const t=new FormData;Object.keys(this.requestData).forEach(r=>{this.requestData[r]!==null&&r!=="image_path"&&t.append(r,this.requestData[r])}),(this.isEdit?b.put(`/withdrawal-request/${this.currentEditId}`,t):b.post("/withdrawal-request",t)).then(r=>{this.showRequestModal=!1,this.fetchRequestss(),this.successMessage=this.isEdit?"Request updated successfully!":"Request submitted successfully!",this.clearSuccessMessage(),this.loading=!1}).catch(r=>{var i,o;this.loading=!1,(o=(i=r.response)==null?void 0:i.data)!=null&&o.errors&&(this.errors=r.response.data.errors)})},approveRequest(t){confirm("Are you sure you want to approve this request?")&&b.patch(`/withdrawal-request/${t.id}/status`,{status:"approved"}).then(e=>{this.fetchRequestss(),this.successMessage=e.data.message||"Request approved successfully!",this.clearSuccessMessage()}).catch(e=>{console.error(e),this.successMessage="Something went wrong while approving the request.",this.clearSuccessMessage()})},rejectRequest(t){this.currentRequestToReject=t,this.rejectReason="",this.showRejectModal=!0},confirmReject(){b.patch(`/withdrawal-request/${this.currentRequestToReject.id}/status`,{status:"rejected",reject_reason:this.rejectReason}).then(()=>{this.fetchRequestss(),this.successMessage="Request rejected successfully!",this.clearSuccessMessage(),this.showRejectModal=!1}).catch(t=>{console.error(t)})},deleteRequest(t){confirm("Are you sure you want to delete this request?")&&b.delete(`/withdrawal-request/${t}`).then(()=>{this.fetchRequestss(),this.successMessage="Request deleted successfully!",this.clearSuccessMessage()}).catch(e=>{console.error(e)})},showImage(t){this.imagePreviewUrl=`/storage/${t}`,this.showImageModal=!0},downloadImage(){const t=document.createElement("a");t.href=this.imagePreviewUrl,t.download=`receipt-${new Date().getTime()}.jpg`,document.body.appendChild(t),t.click(),document.body.removeChild(t)},handleFileChange(t){this.requestData.image=t.target.files[0]},searchFilter(){this.currentPage=1,this.fetchRequestss()},resetFilter(){this.search={transaction_id:"",status:null,recipient:null,from_date:null,to_date:null},this.currentPage=1,this.fetchRequestss()},resetModal(){this.requestData={transaction_id:"",amount:"",description:"",image:null,request_create_for:null,image_path:null},this.errors={},this.isEdit=!1,this.currentEditId=null},clearSuccessMessage(){setTimeout(()=>{this.successMessage=""},3e3)},hasErrors(t){return this.errors&&this.errors[t]},getErrors(t){return this.errors[t][0]},removeError(t){this.errors[t]&&delete this.errors[t]},onSortChanged(t){this.currentPage=1,this.sortBy=t.sortBy,this.sortDesc=t.sortDesc,this.fetchRequestss()}}},Q={class:"dashboard"},Y={class:"list__page"},G={key:0,class:"alert alert-success"},J={class:"list__title"},K={key:1},X={class:"table-container"},Z={key:0},$={class:"font-weight-bold"},ee={key:0,class:"text-danger small mt-1"},te={key:2,class:"text-muted"},se={key:1,class:"d-flex justify-content-center align-items-center",style:{height:"100px"}},ae={class:"mx-2 mb-2"},oe={key:0,class:"d-flex align-items-center"},le={class:"d-flex align-items-center"},re={class:"showing_pagination_result"},ie={class:"d-flex justify-content-end"},ne={key:0,class:"d-flex justify-content-center align-items-center",style:{height:"100px"}},de={key:1},ue={class:"alert alert-danger"},ce={key:2},me={class:"text-muted"},he={key:0,class:"text-danger"},fe={class:"d-flex justify-content-end"},pe={key:0},ge={key:1},_e={class:"text-center"},be=["src"];function we(t,e,r,i,o,u){const g=c("b-button"),x=c("b-form-select-option"),C=c("b-form-select"),w=c("b-form-group"),_=c("b-col"),V=c("v-select"),q=c("b-row"),j=c("b-form-datepicker"),P=c("b-card"),S=c("b-badge"),E=c("b-link"),U=c("b-table"),B=c("b-pagination"),I=c("b-alert"),L=c("b-form-input"),M=c("b-form-textarea"),A=c("b-form"),y=c("b-modal"),O=T("ripple");return n(),m("div",Q,[d("div",Y,[o.successMessage?(n(),m("div",G,f(o.successMessage),1)):p("",!0),d("div",J,[e[17]||(e[17]=d("h4",null,"Withdrawal Requests",-1)),o.isAdmin?p("",!0):(n(),v(g,{key:0,variant:"primary",disabled:o.loading,onClick:e[0]||(e[0]=a=>u.openRequestModal())},{default:s(()=>e[15]||(e[15]=[h(" Create Request ")])),_:1},8,["disabled"])),W((n(),v(g,{variant:"primary",class:"mb-0 ml-md-1 basicButton",onClick:e[1]||(e[1]=a=>o.showfilter=!o.showfilter)},{default:s(()=>e[16]||(e[16]=[h(" Filter ")])),_:1})),[[O,"rgba(113, 102, 240, 0.15)",void 0,{400:!0}]])]),o.showfilter?(n(),m("div",K,[l(P,{class:"filterBox mb-0"},{default:s(()=>[l(q,null,{default:s(()=>[l(_,{md:"4"},{default:s(()=>[l(w,{label:"Status","label-for":"status"},{default:s(()=>[l(C,{modelValue:i.search.status,"onUpdate:modelValue":e[2]||(e[2]=a=>i.search.status=a),options:o.statusOptions,id:"status"},{first:s(()=>[l(x,{value:null},{default:s(()=>e[18]||(e[18]=[h("All Status")])),_:1})]),_:1},8,["modelValue","options"])]),_:1})]),_:1}),o.isAdmin?(n(),v(_,{key:0,md:"4"},{default:s(()=>[l(w,{label:"Recipient","label-for":"recipient"},{default:s(()=>[l(V,{modelValue:i.search.recipient,"onUpdate:modelValue":e[3]||(e[3]=a=>i.search.recipient=a),options:o.userOptions,label:"name",reduce:a=>a.id,placeholder:"Select Recipient"},null,8,["modelValue","options","reduce"])]),_:1})]),_:1})):p("",!0)]),_:1}),l(q,null,{default:s(()=>[l(_,{md:"3"},{default:s(()=>[l(w,{label:"From Date","label-for":"from_date"},{default:s(()=>[l(j,{modelValue:i.search.from_date,"onUpdate:modelValue":e[4]||(e[4]=a=>i.search.from_date=a),id:"from_date"},null,8,["modelValue"])]),_:1})]),_:1}),l(_,{md:"3"},{default:s(()=>[l(w,{label:"To Date","label-for":"to_date"},{default:s(()=>[l(j,{modelValue:i.search.to_date,"onUpdate:modelValue":e[5]||(e[5]=a=>i.search.to_date=a),id:"to_date"},null,8,["modelValue"])]),_:1})]),_:1}),l(_,{md:"2"},{default:s(()=>[l(g,{onClick:u.searchFilter,variant:"primary mt-1 w-100"},{default:s(()=>e[19]||(e[19]=[h(" Search ")])),_:1},8,["onClick"])]),_:1}),l(_,{md:"2"},{default:s(()=>[l(g,{onClick:u.resetFilter,variant:"primary mt-1 w-100"},{default:s(()=>e[20]||(e[20]=[h(" Reset ")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})])):p("",!0),d("div",X,[o.modalLoading?p("",!0):(n(),m("div",Z,[l(U,{responsive:"",stacked:"sm",ref:"refRequestListTable",items:o.fetchRequests,fields:o.fields,onSortChanged:u.onSortChanged,class:"mb-2 staticTable","empty-text":"No matching records found"},{"cell(transaction_id)":s(a=>[d("span",$,f(a.item.transaction_id),1)]),"cell(amount)":s(a=>[h(" â‚¹"+f(a.item.amount.toLocaleString()),1)]),"cell(status)":s(a=>[l(S,{variant:u.getStatusVariant(a.item.status)},{default:s(()=>[h(f(a.item.status),1)]),_:2},1032,["variant"]),a.item.status==="rejected"&&a.item.reject_reason?(n(),m("div",ee," Reason: "+f(a.item.reject_reason),1)):p("",!0)]),"cell(image_path)":s(a=>[l(E,{onClick:R=>u.showImage(a.item.image_path),class:"text-primary cursor-pointer"},{default:s(()=>e[21]||(e[21]=[h(" View Receipt ")])),_:2},1032,["onClick"])]),"cell(actions)":s(a=>[a.item.status==="pending"&&o.isAdmin?(n(),m(D,{key:0},[l(g,{size:"sm",variant:"success",onClick:R=>u.approveRequest(a.item)},{default:s(()=>e[22]||(e[22]=[h(" Approve ")])),_:2},1032,["onClick"]),l(g,{size:"sm",variant:"danger",onClick:R=>u.rejectRequest(a.item),class:"ml-1"},{default:s(()=>e[23]||(e[23]=[h(" Reject ")])),_:2},1032,["onClick"])],64)):!o.isAdmin&&a.item.request_by===o.currentUserId&&a.item.status==="pending"?(n(),m(D,{key:1},[l(g,{size:"sm",variant:"primary",onClick:R=>u.openRequestModal(a.item.id),class:"ml-1"},{default:s(()=>e[24]||(e[24]=[h(" Edit ")])),_:2},1032,["onClick"]),l(g,{size:"sm",variant:"danger",onClick:R=>u.deleteRequest(a.item.id),class:"ml-1"},{default:s(()=>e[25]||(e[25]=[h(" Delete ")])),_:2},1032,["onClick"])],64)):(n(),m("span",te,"No actions available"))]),_:1},8,["items","fields","onSortChanged"])])),o.modalLoading?(n(),m("div",se,e[26]||(e[26]=[d("i",{class:"fas fa-spinner fa-spin fa-3x"},null,-1)]))):p("",!0),d("div",ae,[l(q,{class:"align-items-center"},{default:s(()=>[l(_,{cols:"12",md:"4"},{default:s(()=>[o.modalLoading?p("",!0):(n(),m("div",oe,[e[27]||(e[27]=d("span",{class:"mr-2 showing_pagination_result"},"Show",-1)),l(V,{modelValue:i.perPage,"onUpdate:modelValue":e[6]||(e[6]=a=>i.perPage=a),options:i.perPageOptions,clearable:!1,class:"mr-2"},null,8,["modelValue","options"]),e[28]||(e[28]=d("span",{class:"showing_pagination_result"},"entries",-1))]))]),_:1}),o.modalLoading?p("",!0):(n(),v(_,{key:0,cols:"12",md:"4"},{default:s(()=>[d("div",le,[d("span",re,"Showing "+f(u.rangeStart)+" to "+f(u.rangeEnd)+" of "+f(o.totalrows)+" entries",1)])]),_:1})),l(_,{cols:"12",md:"4"},{default:s(()=>[d("div",ie,[o.totalrows>0&&!o.modalLoading?(n(),v(B,{key:0,modelValue:i.currentPage,"onUpdate:modelValue":e[7]||(e[7]=a=>i.currentPage=a),"total-rows":o.totalrows,"per-page":i.perPage,onInput:t.fetchEntries,pills:"","first-number":"","last-number":"","prev-class":"prev-item","next-class":"next-item"},{"prev-text":s(()=>e[29]||(e[29]=[d("i",{class:"fa-solid fa-angles-left"},null,-1)])),"next-text":s(()=>e[30]||(e[30]=[d("i",{class:"fa-solid fa-angles-right"},null,-1)])),_:1},8,["modelValue","total-rows","per-page","onInput"])):p("",!0)])]),_:1})]),_:1})])]),l(y,{modelValue:o.showRequestModal,"onUpdate:modelValue":e[11]||(e[11]=a=>o.showRequestModal=a),onHide:u.resetModal,centered:"",size:"lg",title:"Create Withdrawal Request","hide-footer":""},{default:s(()=>[o.modalLoading?(n(),m("div",ne,e[31]||(e[31]=[d("i",{class:"fas fa-spinner fa-spin fa-3x"},null,-1)]))):o.canWithdraw?(n(),m("div",ce,[l(I,{variant:"info",show:""},{default:s(()=>[h(" Available Balance: â‚¹"+f(o.availableBalance),1)]),_:1}),l(A,{onSubmit:N(u.submitRequest,["prevent"])},{default:s(()=>[l(q,null,{default:s(()=>[l(_,{md:"6"},{default:s(()=>[l(w,{label:"Amount (â‚¹)","label-for":"amount"},{default:s(()=>[l(L,{id:"amount",type:"number",modelValue:o.requestData.amount,"onUpdate:modelValue":e[8]||(e[8]=a=>o.requestData.amount=a),required:"",min:"1",max:o.availableBalance,placeholder:"Enter amount",onInput:e[9]||(e[9]=a=>u.removeError("amount"))},null,8,["modelValue","max"]),d("small",me,"Available Balance: â‚¹"+f(o.availableBalance),1),u.hasErrors("amount")?(n(),m("div",he,f(u.getErrors("amount")),1)):p("",!0)]),_:1})]),_:1})]),_:1}),l(w,{label:"Description","label-for":"description"},{default:s(()=>[l(M,{id:"description",modelValue:o.requestData.description,"onUpdate:modelValue":e[10]||(e[10]=a=>o.requestData.description=a),rows:"3",placeholder:"Optional description..."},null,8,["modelValue"])]),_:1}),d("div",fe,[l(g,{variant:"primary",disabled:o.loading,type:"submit"},{default:s(()=>[o.loading?(n(),m("span",pe,e[32]||(e[32]=[d("i",{class:"fas fa-spinner fa-spin"},null,-1),h(" Processing... ")]))):(n(),m("span",ge," Submit Request "))]),_:1},8,["disabled"])])]),_:1},8,["onSubmit"])])):(n(),m("div",de,[d("div",ue,f(o.errorMessage),1)]))]),_:1},8,["modelValue","onHide"]),l(y,{modelValue:o.showImageModal,"onUpdate:modelValue":e[12]||(e[12]=a=>o.showImageModal=a),title:"Payment Receipt",centered:""},{"modal-footer":s(()=>[l(g,{variant:"primary",onClick:u.downloadImage},{default:s(()=>e[33]||(e[33]=[h("Download")])),_:1},8,["onClick"])]),default:s(()=>[d("div",_e,[d("img",{src:o.imagePreviewUrl,alt:"Payment Receipt",class:"img-fluid"},null,8,be)])]),_:1},8,["modelValue"]),l(y,{modelValue:o.showRejectModal,"onUpdate:modelValue":e[14]||(e[14]=a=>o.showRejectModal=a),title:"Reject Request",centered:"",onOk:u.confirmReject},{default:s(()=>[l(w,{label:"Reject Reason","label-for":"rejectReason"},{default:s(()=>[l(M,{id:"rejectReason",modelValue:o.rejectReason,"onUpdate:modelValue":e[13]||(e[13]=a=>o.rejectReason=a),rows:"3",required:"",placeholder:"Please specify the reason for rejection..."},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue","onOk"])])])}const ye=F(H,[["render",we],["__scopeId","data-v-d8a9f6ca"]]);export{ye as default};
