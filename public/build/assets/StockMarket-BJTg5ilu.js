import{_ as C,c as r,o as c,b as e,h,n as d,t as n,F as k,r as v,i as S,j as f,X as b,v as p,W as y}from"./app-Da8Q9-cl.js";const I={name:"StockMarket",data(){return{loading:!1,activeTab:"stocks",searchQuery:"",lastUpdated:"",marketStatus:"CLOSED",liveStocks:[],marketIndices:[],searchResults:[],searchSuggestions:[],selectedStock:null,showSuggestions:!1,currentPage:1,itemsPerPage:40,selectedSector:"all",tabs:[{id:"stocks",name:"Live Stocks",icon:"fas fa-chart-line"},{id:"search",name:"Search",icon:"fas fa-search"}],sectors:[{id:"all",name:"All Stocks"},{id:"banking",name:"Banking"},{id:"it",name:"IT & Tech"},{id:"auto",name:"Automobile"},{id:"fmcg",name:"FMCG"},{id:"metal",name:"Metal & Mining"},{id:"energy",name:"Energy & Oil"}]}},computed:{marketStatusClass(){return{"market-open":this.marketStatus==="OPEN","market-closed":this.marketStatus==="CLOSED"}},marketStatusText(){return this.marketStatus==="OPEN"?"Market Open":"Market Closed"},filteredStocks(){let i=this.liveStocks;if(this.selectedSector!=="all"&&(i=i.filter(s=>this.getStockSector(s.trading_symbol)===this.selectedSector)),this.searchQuery){const s=this.searchQuery.toLowerCase();i=i.filter(l=>l.trading_symbol.toLowerCase().includes(s))}return i},paginatedStocks(){const i=(this.currentPage-1)*this.itemsPerPage,s=i+this.itemsPerPage;return this.filteredStocks.slice(i,s)},totalPages(){return Math.ceil(this.filteredStocks.length/this.itemsPerPage)}},mounted(){this.loadMarketData(),this.updateTimestamp(),this.refreshInterval=setInterval(()=>{this.refreshStockData()},5e3)},beforeUnmount(){this.refreshInterval&&clearInterval(this.refreshInterval)},methods:{async loadMarketData(){this.loading=!0,console.log("Loading market data...");try{const i=localStorage.getItem("access_token");console.log("Token:",i?"Present":"Missing");const s=await y.get("/api/upstox/dashboard",{headers:{Authorization:`Bearer ${i}`,Accept:"application/json"}});if(console.log("Dashboard API Response:",s.data),s.data.success){const l=s.data.data;console.log("Processing data:",l),l.quotes&&l.quotes.success&&l.quotes.data&&l.quotes.data.data&&(this.liveStocks=this.formatStockData(l.quotes.data.data),console.log("Live stocks processed:",this.liveStocks)),l.indices&&l.indices.success&&l.indices.data&&l.indices.data.data&&(this.marketIndices=this.formatStockData(l.indices.data.data),console.log("Market indices processed:",this.marketIndices)),l.status&&l.status.success&&l.status.data&&(this.marketStatus=l.status.data.market_status||"CLOSED",console.log("Market status:",this.marketStatus))}}catch(i){console.error("Error loading market data:",i),i.response&&console.error("Error response:",i.response.data)}finally{this.loading=!1,this.updateTimestamp(),console.log("Market data loading completed")}},async refreshStockData(){await this.loadMarketData(),console.log("Market data refreshed")},async searchStocks(){if(!this.searchQuery.trim()){this.searchResults=[];return}try{const i=localStorage.getItem("access_token"),s=await y.get("/api/upstox/search-instruments",{params:{query:this.searchQuery},headers:{Authorization:`Bearer ${i}`}});s.data.success&&(this.searchResults=s.data.data||[])}catch(i){console.error("Error searching stocks:",i)}},formatStockData(i){var l,u,a,o;const s=[];for(const[m,t]of Object.entries(i))s.push({instrument_key:m,trading_symbol:t.trading_symbol||"N/A",last_price:t.last_price||0,net_change:t.net_change||0,percent_change:t.percent_change||0,volume:t.volume||0,open:((l=t.ohlc)==null?void 0:l.open)||0,high:((u=t.ohlc)==null?void 0:u.high)||0,low:((a=t.ohlc)==null?void 0:a.low)||0,close:((o=t.ohlc)==null?void 0:o.close)||0});return s},formatNumber(i){return i?new Intl.NumberFormat("en-IN").format(i):"0"},formatVolume(i){return i?i>=1e7?(i/1e7).toFixed(1)+"Cr":i>=1e5?(i/1e5).toFixed(1)+"L":i>=1e3?(i/1e3).toFixed(1)+"K":i.toString():"0"},updateTimestamp(){this.lastUpdated=new Date().toLocaleTimeString()},addToWatchlist(i){console.log(`${i.trading_symbol} added to watchlist`)},navigateTo(i){this.$router.push(i)},getStockSector(i){const s=["HDFCBANK","ICICIBANK","AXISBANK","KOTAKBANK","SBIN","INDUSINDBK","FEDERALBNK","BANKBARODA","PNB","CANBK"],l=["INFY","TCS","WIPRO","HCLTECH","TECHM","MINDTREE","MPHASIS","LTI","PERSISTENT","COFORGE"],u=["MARUTI","TATAMOTORS","M&M","BAJAJ-AUTO","HEROMOTOCO","EICHERMOT","TVSMOTOR"],a=["ITC","HINDUNILVR","BRITANNIA","DABUR","GODREJCP","MARICO","COLPAL","NESTLEIND"],o=["TATASTEEL","JSWSTEEL","HINDALCO","VEDL","COALINDIA","SAIL"],m=["RELIANCE","ONGC","IOC","BPCL","GAIL"];return s.includes(i)?"banking":l.includes(i)?"it":u.includes(i)?"auto":a.includes(i)?"fmcg":o.includes(i)?"metal":m.includes(i)?"energy":"all"},getStockSectorName(i){const s=this.getStockSector(i);return{banking:"Banking & Finance",it:"IT & Technology",auto:"Automobile",fmcg:"FMCG & Consumer",metal:"Metal & Mining",energy:"Energy & Oil",all:"Others"}[s]||"Others"},onSearchInput(){this.searchQuery.trim().length>=1?(this.updateSearchSuggestions(),this.showSuggestions=!0):(this.searchSuggestions=[],this.showSuggestions=!1)},updateSearchSuggestions(){const i=this.searchQuery.toLowerCase().trim();if(!i){this.searchSuggestions=[];return}this.searchSuggestions=this.liveStocks.filter(s=>s.trading_symbol.toLowerCase().includes(i)).slice(0,15).sort((s,l)=>{const u=s.trading_symbol.toLowerCase().startsWith(i),a=l.trading_symbol.toLowerCase().startsWith(i);return u&&!a?-1:!u&&a?1:s.trading_symbol.localeCompare(l.trading_symbol)})},selectStock(i){this.selectedStock=i,this.searchQuery=i.trading_symbol,this.showSuggestions=!1,console.log("Selected stock:",i.trading_symbol)},clearSearch(){this.searchQuery="",this.searchSuggestions=[],this.selectedStock=null,this.showSuggestions=!1},hideSuggestions(){setTimeout(()=>{this.showSuggestions=!1},200)},viewStockChart(i){console.log("View chart for:",i.trading_symbol)}},watch:{selectedSector(){this.currentPage=1},searchQuery(){this.currentPage=1},itemsPerPage(){this.currentPage=1}}},N={class:"stock-market-screen"},P={class:"page-header"},T={class:"header-content"},A={class:"header-left"},w={class:"header-right"},L={class:"last-updated"},E={class:"indices-section"},M={class:"indices-grid"},O={class:"index-name"},D={class:"index-price"},R={class:"index-change"},B={class:"change-value"},x={class:"change-percent"},F={class:"content-tabs"},V={class:"tab-buttons"},Q=["onClick"],U={class:"tab-content"},H={key:0,class:"tab-panel"},K={class:"panel-header"},q=["disabled"],W={class:"filters-section"},G={class:"filter-group"},J=["value"],j={class:"filter-group"},z={class:"filter-group"},X={class:"stocks-grid"},Y={class:"stock-header"},Z={class:"stock-symbol"},$={class:"stock-price"},ee={class:"stock-change"},se={class:"stock-details"},te={class:"detail-item"},ae={class:"value"},ie={class:"detail-item"},oe={class:"value"},ne={class:"detail-item"},le={class:"value"},re={class:"detail-item"},ce={class:"value"},de={key:0,class:"pagination-section"},ue={class:"pagination-info"},ge={class:"pagination-controls"},he=["disabled"],me=["disabled"],ke={class:"pagination-current"},ve=["disabled"],Se=["disabled"],fe={key:1,class:"tab-panel"},_e={class:"panel-header"},be={class:"search-summary"},pe={class:"summary-text"},ye={class:"search-section"},Ce={class:"search-input-container"},Ie={class:"search-input-group"},Ne={key:0,class:"suggestions-dropdown"},Pe={class:"suggestions-header"},Te=["onMousedown"],Ae={class:"suggestion-content"},we={class:"suggestion-symbol"},Le={class:"suggestion-price"},Ee={class:"suggestion-sector"},Me={key:0,class:"selected-stock-section"},Oe={class:"selected-stock-card"},De={class:"stock-header-section"},Re={class:"stock-main-info"},Be={class:"stock-title"},xe={class:"stock-sector-tag"},Fe={class:"stock-price-info"},Ve={class:"current-price"},Qe={class:"stock-details-grid"},Ue={class:"detail-card"},He={class:"detail-value"},Ke={class:"detail-card"},qe={class:"detail-value high"},We={class:"detail-card"},Ge={class:"detail-value low"},Je={class:"detail-card"},je={class:"detail-value"},ze={class:"stock-actions"},Xe={key:0,class:"loading-overlay"},Ye={class:"mobile-bottom-nav"};function Ze(i,s,l,u,a,o){var m;return c(),r("div",N,[e("div",P,[e("div",T,[e("div",A,[e("button",{class:"back-btn",onClick:s[0]||(s[0]=t=>o.navigateTo("/admin/dashboard"))},s[20]||(s[20]=[e("i",{class:"fas fa-arrow-left"},null,-1)])),s[21]||(s[21]=e("div",{class:"header-info"},[e("h1",{class:"page-title"},"ðŸ“ˆ Stock Market"),e("p",{class:"page-subtitle"},"Live market data powered by Upstox")],-1))]),e("div",w,[e("div",{class:d(["market-status",o.marketStatusClass])},[s[22]||(s[22]=e("div",{class:"status-indicator"},null,-1)),e("span",null,n(o.marketStatusText),1)],2),e("div",L," Last updated: "+n(a.lastUpdated),1)])])]),e("div",E,[s[23]||(s[23]=e("h2",{class:"section-title"},"Market Indices",-1)),e("div",M,[(c(!0),r(k,null,v(a.marketIndices,t=>{var g;return c(),r("div",{key:t.instrument_key,class:d(["index-card",{positive:t.net_change>0,negative:t.net_change<0}])},[e("div",O,n(t.trading_symbol),1),e("div",D,"â‚¹"+n(o.formatNumber(t.last_price)),1),e("div",R,[e("span",B,n(t.net_change>0?"+":"")+n(o.formatNumber(t.net_change)),1),e("span",x,"("+n(t.percent_change>0?"+":"")+n((g=t.percent_change)==null?void 0:g.toFixed(2))+"%)",1)])],2)}),128))])]),e("div",F,[e("div",V,[(c(!0),r(k,null,v(a.tabs,t=>(c(),r("button",{key:t.id,class:d(["tab-btn",{active:a.activeTab===t.id}]),onClick:g=>a.activeTab=t.id},[e("i",{class:d(t.icon)},null,2),S(" "+n(t.name),1)],10,Q))),128))]),e("div",U,[a.activeTab==="stocks"?(c(),r("div",H,[e("div",K,[e("h3",null,"Live Stock Prices ("+n(o.filteredStocks.length)+" stocks)",1),e("button",{class:"refresh-btn",onClick:s[1]||(s[1]=(...t)=>o.refreshStockData&&o.refreshStockData(...t)),disabled:a.loading},[e("i",{class:d(["fas fa-sync-alt",{"fa-spin":a.loading}])},null,2),s[24]||(s[24]=S(" Refresh "))],8,q)]),e("div",W,[e("div",G,[s[25]||(s[25]=e("label",{class:"filter-label"},"Sector:",-1)),f(e("select",{"onUpdate:modelValue":s[2]||(s[2]=t=>a.selectedSector=t),class:"filter-select"},[(c(!0),r(k,null,v(a.sectors,t=>(c(),r("option",{key:t.id,value:t.id},n(t.name),9,J))),128))],512),[[b,a.selectedSector]])]),e("div",j,[s[26]||(s[26]=e("label",{class:"filter-label"},"Search:",-1)),f(e("input",{"onUpdate:modelValue":s[3]||(s[3]=t=>a.searchQuery=t),type:"text",placeholder:"Search stocks...",class:"filter-input"},null,512),[[p,a.searchQuery]])]),e("div",z,[s[28]||(s[28]=e("label",{class:"filter-label"},"Items per page:",-1)),f(e("select",{"onUpdate:modelValue":s[4]||(s[4]=t=>a.itemsPerPage=t),class:"filter-select"},s[27]||(s[27]=[e("option",{value:"20"},"20",-1),e("option",{value:"40"},"40",-1),e("option",{value:"50"},"50",-1),e("option",{value:"100"},"100",-1)]),512),[[b,a.itemsPerPage]])])]),e("div",X,[(c(!0),r(k,null,v(o.paginatedStocks,t=>{var g;return c(),r("div",{key:t.instrument_key,class:d(["stock-card",{positive:t.net_change>0,negative:t.net_change<0}])},[e("div",Y,[e("div",Z,n(t.trading_symbol),1),e("div",{class:d(["stock-change-badge",t.net_change>0?"positive":"negative"])},n(t.percent_change>0?"+":"")+n((g=t.percent_change)==null?void 0:g.toFixed(2))+"% ",3)]),e("div",$,"â‚¹"+n(o.formatNumber(t.last_price)),1),e("div",ee,n(t.net_change>0?"+":"")+n(o.formatNumber(t.net_change)),1),e("div",se,[e("div",te,[s[29]||(s[29]=e("span",{class:"label"},"Open:",-1)),e("span",ae,"â‚¹"+n(o.formatNumber(t.open)),1)]),e("div",ie,[s[30]||(s[30]=e("span",{class:"label"},"High:",-1)),e("span",oe,"â‚¹"+n(o.formatNumber(t.high)),1)]),e("div",ne,[s[31]||(s[31]=e("span",{class:"label"},"Low:",-1)),e("span",le,"â‚¹"+n(o.formatNumber(t.low)),1)]),e("div",re,[s[32]||(s[32]=e("span",{class:"label"},"Volume:",-1)),e("span",ce,n(o.formatVolume(t.volume)),1)])])],2)}),128))]),o.totalPages>1?(c(),r("div",de,[e("div",ue," Showing "+n((a.currentPage-1)*a.itemsPerPage+1)+"-"+n(Math.min(a.currentPage*a.itemsPerPage,o.filteredStocks.length))+" of "+n(o.filteredStocks.length)+" stocks ",1),e("div",ge,[e("button",{onClick:s[5]||(s[5]=t=>a.currentPage=1),disabled:a.currentPage===1,class:"pagination-btn"},s[33]||(s[33]=[e("i",{class:"fas fa-angle-double-left"},null,-1)]),8,he),e("button",{onClick:s[6]||(s[6]=t=>a.currentPage--),disabled:a.currentPage===1,class:"pagination-btn"},s[34]||(s[34]=[e("i",{class:"fas fa-angle-left"},null,-1)]),8,me),e("span",ke,n(a.currentPage)+" / "+n(o.totalPages),1),e("button",{onClick:s[7]||(s[7]=t=>a.currentPage++),disabled:a.currentPage===o.totalPages,class:"pagination-btn"},s[35]||(s[35]=[e("i",{class:"fas fa-angle-right"},null,-1)]),8,ve),e("button",{onClick:s[8]||(s[8]=t=>a.currentPage=o.totalPages),disabled:a.currentPage===o.totalPages,class:"pagination-btn"},s[36]||(s[36]=[e("i",{class:"fas fa-angle-double-right"},null,-1)]),8,Se)])])):h("",!0)])):h("",!0),a.activeTab==="search"?(c(),r("div",fe,[e("div",_e,[s[37]||(s[37]=e("h3",null,"Search Stocks",-1)),e("div",be,[e("span",pe,"ðŸ” Find stocks from "+n(a.liveStocks.length)+" available stocks",1)])]),e("div",ye,[s[48]||(s[48]=e("div",{class:"search-header"},[e("h4",null,"Quick Search"),e("p",null,"Type stock name or symbol to get instant suggestions")],-1)),e("div",Ce,[e("div",Ie,[s[39]||(s[39]=e("div",{class:"search-icon"},[e("i",{class:"fas fa-search"})],-1)),f(e("input",{"onUpdate:modelValue":s[9]||(s[9]=t=>a.searchQuery=t),type:"text",placeholder:"Type stock name or symbol (e.g., RELIANCE, TCS, INFY)...",class:"search-input",onInput:s[10]||(s[10]=(...t)=>o.onSearchInput&&o.onSearchInput(...t)),onFocus:s[11]||(s[11]=t=>a.showSuggestions=!0),onBlur:s[12]||(s[12]=(...t)=>o.hideSuggestions&&o.hideSuggestions(...t))},null,544),[[p,a.searchQuery]]),a.searchQuery?(c(),r("button",{key:0,class:"clear-btn",onClick:s[13]||(s[13]=(...t)=>o.clearSearch&&o.clearSearch(...t))},s[38]||(s[38]=[e("i",{class:"fas fa-times"},null,-1)]))):h("",!0)]),a.showSuggestions&&a.searchSuggestions.length>0?(c(),r("div",Ne,[e("div",Pe,[e("span",null,n(a.searchSuggestions.length)+" matches found",1)]),(c(!0),r(k,null,v(a.searchSuggestions,(t,g)=>{var _;return c(),r("div",{key:t.instrument_key,class:"suggestion-item",onMousedown:$e=>o.selectStock(t)},[e("div",Ae,[e("div",we,n(t.trading_symbol),1),e("div",Le,"â‚¹"+n(o.formatNumber(t.last_price)),1),e("div",{class:d(["suggestion-change",t.net_change>0?"positive":"negative"])},n(t.net_change>0?"+":"")+n((_=t.percent_change)==null?void 0:_.toFixed(2))+"% ",3)]),e("div",Ee,n(o.getStockSectorName(t.trading_symbol)),1)],40,Te)}),128))])):h("",!0)]),a.selectedStock?(c(),r("div",Me,[s[47]||(s[47]=e("h4",null,"Stock Details",-1)),e("div",Oe,[e("div",De,[e("div",Re,[e("h3",Be,n(a.selectedStock.trading_symbol),1),e("div",xe,n(o.getStockSectorName(a.selectedStock.trading_symbol)),1)]),e("div",Fe,[e("div",Ve,"â‚¹"+n(o.formatNumber(a.selectedStock.last_price)),1),e("div",{class:d(["price-change",a.selectedStock.net_change>0?"positive":"negative"])},n(a.selectedStock.net_change>0?"+":"")+"â‚¹"+n(o.formatNumber(a.selectedStock.net_change))+" ("+n(a.selectedStock.percent_change>0?"+":"")+n((m=a.selectedStock.percent_change)==null?void 0:m.toFixed(2))+"%) ",3)])]),e("div",Qe,[e("div",Ue,[s[40]||(s[40]=e("div",{class:"detail-label"},"Open",-1)),e("div",He,"â‚¹"+n(o.formatNumber(a.selectedStock.open)),1)]),e("div",Ke,[s[41]||(s[41]=e("div",{class:"detail-label"},"High",-1)),e("div",qe,"â‚¹"+n(o.formatNumber(a.selectedStock.high)),1)]),e("div",We,[s[42]||(s[42]=e("div",{class:"detail-label"},"Low",-1)),e("div",Ge,"â‚¹"+n(o.formatNumber(a.selectedStock.low)),1)]),e("div",Je,[s[43]||(s[43]=e("div",{class:"detail-label"},"Volume",-1)),e("div",je,n(o.formatVolume(a.selectedStock.volume)),1)])]),e("div",ze,[e("button",{class:"action-btn primary",onClick:s[14]||(s[14]=t=>o.addToWatchlist(a.selectedStock))},s[44]||(s[44]=[e("i",{class:"fas fa-star"},null,-1),S(" Add to Watchlist ")])),e("button",{class:"action-btn secondary",onClick:s[15]||(s[15]=t=>o.viewStockChart(a.selectedStock))},s[45]||(s[45]=[e("i",{class:"fas fa-chart-line"},null,-1),S(" View Chart ")])),e("button",{class:"action-btn secondary",onClick:s[16]||(s[16]=t=>a.selectedStock=null)},s[46]||(s[46]=[e("i",{class:"fas fa-times"},null,-1),S(" Close ")]))])])])):h("",!0)])])):h("",!0)])]),a.loading?(c(),r("div",Xe,s[49]||(s[49]=[e("div",{class:"loading-spinner"},[e("i",{class:"fas fa-spinner fa-spin"}),e("p",null,"Loading market data...")],-1)]))):h("",!0),e("div",Ye,[e("button",{onClick:s[17]||(s[17]=t=>o.navigateTo("/admin/dashboard")),class:"nav-item"},s[50]||(s[50]=[e("i",{class:"fas fa-home"},null,-1),e("span",null,"Dashboard",-1)])),e("button",{onClick:s[18]||(s[18]=(...t)=>o.refreshStockData&&o.refreshStockData(...t)),class:"nav-item"},s[51]||(s[51]=[e("i",{class:"fas fa-sync-alt"},null,-1),e("span",null,"Refresh",-1)])),e("button",{onClick:s[19]||(s[19]=t=>a.activeTab="search"),class:"nav-item"},s[52]||(s[52]=[e("i",{class:"fas fa-search"},null,-1),e("span",null,"Search",-1)]))])])}const ss=C(I,[["render",Ze],["__scopeId","data-v-9aada43f"]]);export{ss as default};
