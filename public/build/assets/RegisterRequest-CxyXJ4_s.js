import{_ as V,f as c,D as v,L as X,E as H,c as l,o as i,b as t,i as k,n as E,t as n,j as D,v as z,X as $,h as P,F as W,r as Y}from"./app-BkEqzjTI.js";const O={class:"register-request-screen"},Z={class:"page-header"},J={class:"header-content"},Q={class:"header-right"},G=["disabled"],K={class:"stats-cards"},ee={class:"stat-card"},te={class:"stat-content"},se={class:"stat-number"},ae={class:"stat-card"},oe={class:"stat-content"},ne={class:"stat-number"},le={class:"stat-card"},ie={class:"stat-content"},re={class:"stat-number"},de={class:"filters-section"},ue={class:"search-box"},ce={class:"filter-options"},pe={class:"results-info"},ve={class:"results-count"},ge={class:"requests-container"},fe={key:0,class:"loading-state"},he={key:1,class:"error-state"},_e={key:2,class:"empty-state"},me={key:3,class:"requests-list"},we={class:"request-header"},ye={class:"user-info"},be={class:"user-avatar"},ke=["src","alt"],De={class:"user-details"},je={class:"user-name"},Re={class:"user-email"},Ae={class:"user-phone"},qe={class:"request-status"},Ce={class:"request-body"},Ee={class:"request-meta"},$e={class:"meta-item"},Se={class:"meta-item"},Pe={key:0,class:"request-actions"},xe=["onClick","disabled"],Fe={key:0},Me={key:1},Te=["onClick","disabled"],Ie={key:0},Le={key:1},Be={key:1,class:"request-actions"},Ne={class:"processed-info"},Ue={key:0,class:"approved-info"},Ve={key:1,class:"rejected-info"},Xe={key:4,class:"pagination"},He=["disabled"],ze=["disabled"],We={class:"page-info"},Ye=["disabled"],Oe=["disabled"],Ze={__name:"RegisterRequest",setup(Je){const g=c(!1),j=c(null),d=c([]),f=c(""),h=c("all"),_=c("all"),y=c("latest"),u=c(1),R=c(10),p=c(null),A=`${window.location.origin}/api`,b=v(()=>{let a=d.value;if(f.value){const e=f.value.toLowerCase();a=a.filter(s=>s.name.toLowerCase().includes(e)||s.email.toLowerCase().includes(e)||s.phone.includes(e))}if(h.value!=="all"&&(a=a.filter(e=>e.status===h.value)),_.value!=="all"){const e=new Date,s=new Date(e.getFullYear(),e.getMonth(),e.getDate());a=a.filter(o=>{const r=new Date(o.created_at);switch(_.value){case"today":return r>=s;case"week":const w=new Date(s.getTime()-7*24*60*60*1e3);return r>=w;case"month":const U=new Date(s.getFullYear(),s.getMonth()-1,s.getDate());return r>=U;default:return!0}})}return a.sort((e,s)=>{switch(y.value){case"latest":return new Date(s.created_at)-new Date(e.created_at);case"oldest":return new Date(e.created_at)-new Date(s.created_at);case"name":return e.name.localeCompare(s.name);case"email":return e.email.localeCompare(s.email);default:return new Date(s.created_at)-new Date(e.created_at)}}),a}),x=v(()=>{const a=(u.value-1)*R.value,e=a+R.value;return b.value.slice(a,e)}),m=v(()=>Math.ceil(b.value.length/R.value)),F=v(()=>d.value.filter(a=>a.status==="pending").length),M=v(()=>{const a=new Date,e=new Date(a.getFullYear(),a.getMonth(),a.getDate());return d.value.filter(s=>s.status==="approved"&&new Date(s.updated_at)>=e).length}),T=v(()=>{const a=new Date,e=new Date(a.getFullYear(),a.getMonth(),a.getDate());return d.value.filter(s=>s.status==="rejected"&&new Date(s.updated_at)>=e).length});X([f,h,_,y],()=>{u.value=1});const q=async()=>{try{g.value=!0,j.value=null;const a=localStorage.getItem("access_token");if(!a)throw new Error("No access token found. Please login again.");const e=await fetch(`${A}/register-requests`,{headers:{Authorization:`Bearer ${a}`,Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(e.status===401)throw new Error("Authentication failed. Please login again.");if(!e.ok){const o=await e.json();throw new Error(o.message||"Failed to fetch requests")}const s=await e.json();if(s.success)d.value=s.data;else throw new Error(s.message||"Failed to fetch requests")}catch(a){console.error("Error fetching requests:",a),a.value=a.message}finally{g.value=!1}},I=async a=>{try{p.value=a.id;const e=localStorage.getItem("access_token");if(!e)throw new Error("No access token found. Please login again.");const s=await fetch(`${A}/register-requests/${a.id}/approve`,{method:"PATCH",headers:{Authorization:`Bearer ${e}`,Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(s.status===401)throw new Error("Authentication failed. Please login again.");if(!s.ok){const r=await s.json();throw new Error(r.message||"Failed to approve request")}const o=await s.json();if(o.success){const r=d.value.findIndex(w=>w.id===a.id);r!==-1&&(d.value[r].status="approved",d.value[r].updated_at=new Date().toISOString()),alert("User registration approved successfully!")}else throw new Error(o.message||"Failed to approve request")}catch(e){console.error("Error approving request:",e),alert(`Error approving request: ${e.message}`)}finally{p.value=null}},L=async a=>{try{p.value=a.id;const e=localStorage.getItem("access_token");if(!e)throw new Error("No access token found. Please login again.");const s=await fetch(`${A}/register-requests/${a.id}/reject`,{method:"PATCH",headers:{Authorization:`Bearer ${e}`,Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(s.status===401)throw new Error("Authentication failed. Please login again.");if(!s.ok){const r=await s.json();throw new Error(r.message||"Failed to reject request")}const o=await s.json();if(o.success){const r=d.value.findIndex(w=>w.id===a.id);r!==-1&&(d.value[r].status="rejected",d.value[r].updated_at=new Date().toISOString()),alert("User registration rejected successfully!")}else throw new Error(o.message||"Failed to reject request")}catch(e){console.error("Error rejecting request:",e),alert(`Error rejecting request: ${e.message}`)}finally{p.value=null}},S=a=>({pending:"status-pending",approved:"status-approved",rejected:"status-rejected"})[a]||"status-pending",B=a=>({pending:"Pending",approved:"Approved",rejected:"Rejected"})[a]||"Pending",C=a=>new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),N=a=>{const e=new Date,s=new Date(a),o=Math.floor((e-s)/(1e3*60));return o<1?"Just now":o<60?`${o} minutes ago`:o<1440?`${Math.floor(o/60)} hours ago`:`${Math.floor(o/1440)} days ago`};return H(()=>{q()}),(a,e)=>(i(),l("div",O,[t("div",Z,[t("div",J,[e[9]||(e[9]=t("div",{class:"header-left"},[t("h1",{class:"page-title"},[t("i",{class:"fa-solid fa-user-plus"}),k(" Register Request ")]),t("p",{class:"page-subtitle"}," Review and approve new user registration requests ")],-1)),t("div",Q,[t("button",{class:"btn-refresh",onClick:q,disabled:g.value},[t("i",{class:E(["fa-solid fa-rotate",{"fa-spin":g.value}])},null,2),e[8]||(e[8]=k(" Refresh "))],8,G)])])]),t("div",K,[t("div",ee,[e[11]||(e[11]=t("div",{class:"stat-icon pending"},"📝",-1)),t("div",te,[t("h3",se,n(F.value),1),e[10]||(e[10]=t("p",{class:"stat-label"},"Pending Requests",-1))])]),t("div",ae,[e[13]||(e[13]=t("div",{class:"stat-icon approved"},"✅",-1)),t("div",oe,[t("h3",ne,n(M.value),1),e[12]||(e[12]=t("p",{class:"stat-label"},"Approved Today",-1))])]),t("div",le,[e[15]||(e[15]=t("div",{class:"stat-icon rejected"},"❌",-1)),t("div",ie,[t("h3",re,n(T.value),1),e[14]||(e[14]=t("p",{class:"stat-label"},"Rejected Today",-1))])])]),t("div",de,[t("div",ue,[e[16]||(e[16]=t("i",{class:"fa-solid fa-search"},null,-1)),D(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=s=>f.value=s),placeholder:"Search by name, email, or phone...",class:"search-input"},null,512),[[z,f.value]])]),t("div",ce,[D(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>h.value=s),class:"filter-select"},e[17]||(e[17]=[t("option",{value:"all"},"All Status",-1),t("option",{value:"pending"},"Pending",-1),t("option",{value:"approved"},"Approved",-1),t("option",{value:"rejected"},"Rejected",-1)]),512),[[$,h.value]]),D(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>_.value=s),class:"filter-select"},e[18]||(e[18]=[t("option",{value:"all"},"All Time",-1),t("option",{value:"today"},"Today",-1),t("option",{value:"week"},"This Week",-1),t("option",{value:"month"},"This Month",-1)]),512),[[$,_.value]]),D(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>y.value=s),class:"filter-select"},e[19]||(e[19]=[t("option",{value:"latest"},"🕐 Latest First",-1),t("option",{value:"oldest"},"🕐 Oldest First",-1),t("option",{value:"name"},"🔤 Name A-Z",-1),t("option",{value:"email"},"📧 Email A-Z",-1)]),512),[[$,y.value]])]),t("div",pe,[t("span",ve," Showing "+n(b.value.length)+" of "+n(d.value.length)+" requests ",1)])]),t("div",ge,[g.value?(i(),l("div",fe,e[20]||(e[20]=[t("i",{class:"fa-solid fa-spinner fa-spin"},null,-1),t("p",null,"Loading registration requests...",-1)]))):j.value?(i(),l("div",he,[e[21]||(e[21]=t("i",{class:"fa-solid fa-exclamation-triangle"},null,-1)),t("p",null,n(j.value),1),t("button",{class:"btn-retry",onClick:q},"Retry")])):b.value.length===0?(i(),l("div",_e,e[22]||(e[22]=[t("i",{class:"fa-solid fa-inbox"},null,-1),t("p",null,"No registration requests found",-1)]))):(i(),l("div",me,[(i(!0),l(W,null,Y(x.value,s=>(i(),l("div",{key:s.id,class:E(["request-card",S(s.status)])},[t("div",we,[t("div",ye,[t("div",be,[t("img",{src:s.profile_image||"../assest/img/tableprofileimg.png",alt:s.name},null,8,ke)]),t("div",De,[t("h4",je,n(s.name),1),t("p",Re,n(s.email),1),t("p",Ae,n(s.phone),1)])]),t("div",qe,[t("span",{class:E(["status-badge",S(s.status)])},n(B(s.status)),3)])]),t("div",Ce,[t("div",Ee,[t("div",$e,[e[23]||(e[23]=t("i",{class:"fa-solid fa-calendar"},null,-1)),t("span",null,"Requested: "+n(C(s.created_at)),1)]),t("div",Se,[e[24]||(e[24]=t("i",{class:"fa-solid fa-clock"},null,-1)),t("span",null,n(N(s.created_at)),1)])]),s.status==="pending"?(i(),l("div",Pe,[t("button",{class:"btn-approve",onClick:o=>I(s),disabled:p.value===s.id},[e[25]||(e[25]=t("i",{class:"fa-solid fa-check"},null,-1)),p.value===s.id?(i(),l("span",Fe,"Approving...")):(i(),l("span",Me,"Approve"))],8,xe),t("button",{class:"btn-reject",onClick:o=>L(s),disabled:p.value===s.id},[e[26]||(e[26]=t("i",{class:"fa-solid fa-times"},null,-1)),p.value===s.id?(i(),l("span",Ie,"Rejecting...")):(i(),l("span",Le,"Reject"))],8,Te)])):(i(),l("div",Be,[t("div",Ne,[s.status==="approved"?(i(),l("span",Ue,[e[27]||(e[27]=t("i",{class:"fa-solid fa-check-circle"},null,-1)),k(" Approved by "+n(s.approved_by||"Admin")+" on "+n(C(s.updated_at)),1)])):s.status==="rejected"?(i(),l("span",Ve,[e[28]||(e[28]=t("i",{class:"fa-solid fa-times-circle"},null,-1)),k(" Rejected by "+n(s.rejected_by||"Admin")+" on "+n(C(s.updated_at)),1)])):P("",!0)])]))])],2))),128))])),m.value>1?(i(),l("div",Xe,[t("button",{class:"btn-page",disabled:u.value===1,onClick:e[4]||(e[4]=s=>u.value=1)},e[29]||(e[29]=[t("i",{class:"fa-solid fa-angles-left"},null,-1)]),8,He),t("button",{class:"btn-page",disabled:u.value===1,onClick:e[5]||(e[5]=s=>u.value--)},e[30]||(e[30]=[t("i",{class:"fa-solid fa-angle-left"},null,-1)]),8,ze),t("span",We," Page "+n(u.value)+" of "+n(m.value),1),t("button",{class:"btn-page",disabled:u.value===m.value,onClick:e[6]||(e[6]=s=>u.value++)},e[31]||(e[31]=[t("i",{class:"fa-solid fa-angle-right"},null,-1)]),8,Ye),t("button",{class:"btn-page",disabled:u.value===m.value,onClick:e[7]||(e[7]=s=>u.value=m.value)},e[32]||(e[32]=[t("i",{class:"fa-solid fa-angles-right"},null,-1)]),8,Oe)])):P("",!0)])]))}},Ge=V(Ze,[["__scopeId","data-v-04e2b622"]]);export{Ge as default};
