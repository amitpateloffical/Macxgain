/* empty css                   */import{_ as F,g as f,Z as W,c as m,o as d,b as s,h as p,l as r,t as h,Q as q,j as k,n as V,q as o,i as c,F as j,w as N,v as x,s as g,f as M}from"./app-BkEqzjTI.js";import{C as T}from"./vue-select.es-DABFBx6R.js";const z={components:{vSelect:T},data(){return{errors:{},showfilter:!1,fetchRequests:[],userBalance:0,balanceLoading:!1,fields:[{key:"amount",label:"Amount",sortable:!0},{key:"description",label:"Description"},{key:"status",label:"Status",sortable:!0},{key:"request_create_for",label:"Recipient",formatter:(t,e,n)=>n.recipient.name},{key:"created_at",label:"Request Date",sortable:!0,formatter:t=>new Date(t).toLocaleString()},{key:"actions",label:"Actions"}],requestData:{transaction_id:"",amount:"",description:"",image:null,request_create_for:null,image_path:null},showRequestModal:!1,showImageModal:!1,showRejectModal:!1,isEdit:!1,loading:!1,successMessage:"",statusOptions:[{value:"pending",text:"Pending"},{value:"approved",text:"Approved"},{value:"rejected",text:"Rejected"}],userOptions:[],totalrows:0,sortBy:"",sortDesc:!0,modalLoading:!1,editmodalLoading:!1,imagePreviewUrl:"",currentEditId:null,currentRequestToReject:null,rejectReason:"",isAdmin:!1,currentUserId:null,canWithdraw:!1,availableBalance:0,errorMessage:""}},computed:{rangeStart(){return this.totalrows===0?0:(this.currentPage-1)*this.perPage+1},rangeEnd(){return this.currentPage*this.perPage>=this.totalrows?this.totalrows:this.currentPage*this.perPage}},setup(){const t=M({transaction_id:"",status:null,recipient:null,from_date:null,to_date:null}),e=M(1),n=M(10);return{search:t,currentPage:e,perPage:n,perPageOptions:[10,25,50,100]}},mounted(){this.fetchUserInfo(),this.fetchRequestss(),this.fetchUsers(),this.fetchUserBalance()},methods:{fetchUserInfo(){g.get("/user-info").then(t=>{this.isAdmin=t.data.is_admin,this.currentUserId=t.data.id}).catch(t=>{console.error(t)})},async fetchUserBalance(){this.balanceLoading=!0;try{const t=JSON.parse(localStorage.getItem("userData"));if(t&&t.id){const e=await g.post("/total_b",{id:t.id});e.data&&e.data.total_balance!==void 0&&(this.userBalance=e.data.total_balance,t.total_balance=e.data.total_balance,localStorage.setItem("userData",JSON.stringify(t)))}}catch(t){console.error("Error fetching balance:",t);const e=JSON.parse(localStorage.getItem("userData"));e&&e.total_balance!==void 0&&(this.userBalance=e.total_balance)}finally{this.balanceLoading=!1}},formatBalance(t){return t==null?"0.00":parseFloat(t).toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})},getStatusVariant(t){switch(t){case"approved":return"success";case"rejected":return"danger";default:return"warning"}},fetchRequestss(){this.modalLoading=!0,g.get("/withdrawal-request",{params:{page:this.currentPage,perPage:this.perPage,sortBy:this.sortBy,sortDesc:this.sortDesc,...this.search}}).then(t=>{this.fetchRequests=t.data.data,this.totalrows=t.data.total,this.modalLoading=!1}).catch(t=>{console.error(t),this.modalLoading=!1})},fetchUsers(){g.get("/users").then(t=>{this.userOptions=t.data}).catch(t=>{console.error(t)})},openRequestModal(t=null){this.showRequestModal=!0,this.modalLoading=!0,this.canWithdraw=!1,g.get("/checkBankInfo").then(e=>{e.data.status==="success"?(this.availableBalance=e.data.data.balance,this.canWithdraw=!0):(this.errorMessage=e.data.message,this.canWithdraw=!1)}).catch(e=>{var n,u;this.errorMessage=((u=(n=e.response)==null?void 0:n.data)==null?void 0:u.message)||"Something went wrong!",this.canWithdraw=!1}).finally(()=>{this.modalLoading=!1}),this.isEdit=!!t,this.currentEditId=t,t?(this.editmodalLoading=!0,g.get(`/withdrawal-request/${t}`).then(e=>{const n=e.data.data;this.requestData.transaction_id=n.transaction_id,this.requestData.amount=n.amount,this.requestData.description=n.description,this.requestData.image_path=n.image_path,this.requestData.image=n.image,this.editmodalLoading=!1}).catch(e=>{console.error(e),this.editmodalLoading=!1})):this.requestData={transaction_id:"",amount:"",description:"",image:null,request_create_for:null,image_path:null}},submitRequest(){this.loading=!0;const t=new FormData;Object.keys(this.requestData).forEach(n=>{this.requestData[n]!==null&&n!=="image_path"&&t.append(n,this.requestData[n])}),(this.isEdit?g.put(`/withdrawal-request/${this.currentEditId}`,t):g.post("/withdrawal-request",t)).then(n=>{this.showRequestModal=!1,this.fetchRequestss(),this.successMessage=this.isEdit?"Request updated successfully!":"Request submitted successfully!",this.clearSuccessMessage(),this.loading=!1}).catch(n=>{var u,l;this.loading=!1,(l=(u=n.response)==null?void 0:u.data)!=null&&l.errors&&(this.errors=n.response.data.errors)})},approveRequest(t){confirm("Are you sure you want to approve this request?")&&g.patch(`/withdrawal-request/${t.id}/status`,{status:"approved"}).then(e=>{this.fetchRequestss(),this.successMessage=e.data.message||"Request approved successfully!",this.clearSuccessMessage()}).catch(e=>{console.error(e),this.successMessage="Something went wrong while approving the request.",this.clearSuccessMessage()})},rejectRequest(t){this.currentRequestToReject=t,this.rejectReason="",this.showRejectModal=!0},confirmReject(){g.patch(`/withdrawal-request/${this.currentRequestToReject.id}/status`,{status:"rejected",reject_reason:this.rejectReason}).then(()=>{this.fetchRequestss(),this.successMessage="Request rejected successfully!",this.clearSuccessMessage(),this.showRejectModal=!1}).catch(t=>{console.error(t)})},deleteRequest(t){confirm("Are you sure you want to delete this request?")&&g.delete(`/withdrawal-request/${t}`).then(()=>{this.fetchRequestss(),this.successMessage="Request deleted successfully!",this.clearSuccessMessage()}).catch(e=>{console.error(e)})},showImage(t){this.imagePreviewUrl=`/storage/${t}`,this.showImageModal=!0},downloadImage(){const t=document.createElement("a");t.href=this.imagePreviewUrl,t.download=`receipt-${new Date().getTime()}.jpg`,document.body.appendChild(t),t.click(),document.body.removeChild(t)},handleFileChange(t){this.requestData.image=t.target.files[0]},searchFilter(){this.currentPage=1,this.fetchRequestss()},resetFilter(){this.search={transaction_id:"",status:null,recipient:null,from_date:null,to_date:null},this.currentPage=1,this.fetchRequestss()},resetModal(){this.requestData={transaction_id:"",amount:"",description:"",image:null,request_create_for:null,image_path:null},this.errors={},this.isEdit=!1,this.currentEditId=null},closeModal(){this.showRequestModal=!1,this.resetModal()},clearSuccessMessage(){setTimeout(()=>{this.successMessage=""},3e3)},hasErrors(t){return this.errors&&this.errors[t]},getErrors(t){return this.errors[t][0]},removeError(t){this.errors[t]&&delete this.errors[t]},onSortChanged(t){this.currentPage=1,this.sortBy=t.sortBy,this.sortDesc=t.sortDesc,this.fetchRequestss()}}},J={class:"dashboard"},H={class:"list__page"},G={key:0,class:"alert alert-success"},Q={class:"list__title"},Z={class:"title-section"},K={key:0,class:"balance-display"},X={class:"balance-card-small"},Y={class:"balance-amount-small"},$=["disabled"],ee={key:1},te={class:"table-container"},se={key:0},ae={class:"font-weight-bold"},le={key:0,class:"text-danger small mt-1"},oe={key:2,class:"text-muted"},re={key:1,class:"d-flex justify-content-center align-items-center",style:{height:"100px"}},ie={class:"mx-2 mb-2"},ne={key:0,class:"d-flex align-items-center"},de={class:"d-flex align-items-center"},ue={class:"showing_pagination_result"},ce={class:"d-flex justify-content-end"},me={class:"modal-header-content"},fe=["onClick"],he={key:0,class:"loading-container"},pe={key:1,class:"error-container"},ge={class:"error-message"},be={class:"error-actions"},_e={key:2,class:"withdrawal-form-container"},we={class:"balance-display-card"},ve={class:"balance-info"},qe={class:"balance-amount"},Re={class:"form-group-modern"},ye={class:"input-wrapper"},ke=["max"],Me={class:"input-help"},De={key:0,class:"error-text"},Ce={class:"form-group-modern"},Ve={class:"input-wrapper"},je={class:"form-actions"},xe=["disabled"],Se={key:0,class:"btn-loading"},Pe={key:1,class:"btn-content"},Be={class:"text-center"},Ue=["src"];function Le(t,e,n,u,l,i){const b=f("b-button"),S=f("b-form-select-option"),P=f("b-form-select"),w=f("b-form-group"),_=f("b-col"),D=f("v-select"),R=f("b-row"),C=f("b-form-datepicker"),B=f("b-card"),U=f("b-badge"),L=f("b-link"),E=f("b-table"),I=f("b-pagination"),y=f("b-modal"),A=f("b-form-textarea"),O=W("ripple");return d(),m("div",J,[s("div",H,[l.successMessage?(d(),m("div",G,h(l.successMessage),1)):p("",!0),s("div",Q,[s("div",Z,[e[20]||(e[20]=s("h4",null,"Withdrawal Requests",-1)),l.isAdmin?p("",!0):(d(),m("div",K,[s("div",X,[e[19]||(e[19]=s("div",{class:"balance-header-small"},[s("i",{class:"bi bi-wallet2 me-1"}),s("span",null,"Available Balance")],-1)),s("div",Y," â‚¹"+h(i.formatBalance(l.userBalance)),1),s("button",{onClick:e[0]||(e[0]=(...a)=>i.fetchUserBalance&&i.fetchUserBalance(...a)),class:"refresh-btn-small",disabled:l.balanceLoading},[s("i",{class:V(["bi bi-arrow-clockwise",{spinning:l.balanceLoading}])},null,2)],8,$)])]))]),l.isAdmin?p("",!0):(d(),q(b,{key:0,variant:"primary",disabled:l.loading,onClick:e[1]||(e[1]=a=>i.openRequestModal())},{default:o(()=>e[21]||(e[21]=[c(" Create Request ")])),_:1},8,["disabled"])),k((d(),q(b,{variant:"primary",class:"mb-0 ml-md-1 basicButton",onClick:e[2]||(e[2]=a=>l.showfilter=!l.showfilter)},{default:o(()=>e[22]||(e[22]=[c(" Filter ")])),_:1})),[[O,"rgba(113, 102, 240, 0.15)",void 0,{400:!0}]])]),l.showfilter?(d(),m("div",ee,[r(B,{class:"filterBox mb-0"},{default:o(()=>[r(R,null,{default:o(()=>[r(_,{md:"4"},{default:o(()=>[r(w,{label:"Status","label-for":"status"},{default:o(()=>[r(P,{modelValue:u.search.status,"onUpdate:modelValue":e[3]||(e[3]=a=>u.search.status=a),options:l.statusOptions,id:"status"},{first:o(()=>[r(S,{value:null},{default:o(()=>e[23]||(e[23]=[c("All Status")])),_:1})]),_:1},8,["modelValue","options"])]),_:1})]),_:1}),l.isAdmin?(d(),q(_,{key:0,md:"4"},{default:o(()=>[r(w,{label:"Recipient","label-for":"recipient"},{default:o(()=>[r(D,{modelValue:u.search.recipient,"onUpdate:modelValue":e[4]||(e[4]=a=>u.search.recipient=a),options:l.userOptions,label:"name",reduce:a=>a.id,placeholder:"Select Recipient"},null,8,["modelValue","options","reduce"])]),_:1})]),_:1})):p("",!0)]),_:1}),r(R,null,{default:o(()=>[r(_,{md:"3"},{default:o(()=>[r(w,{label:"From Date","label-for":"from_date"},{default:o(()=>[r(C,{modelValue:u.search.from_date,"onUpdate:modelValue":e[5]||(e[5]=a=>u.search.from_date=a),id:"from_date"},null,8,["modelValue"])]),_:1})]),_:1}),r(_,{md:"3"},{default:o(()=>[r(w,{label:"To Date","label-for":"to_date"},{default:o(()=>[r(C,{modelValue:u.search.to_date,"onUpdate:modelValue":e[6]||(e[6]=a=>u.search.to_date=a),id:"to_date"},null,8,["modelValue"])]),_:1})]),_:1}),r(_,{md:"2"},{default:o(()=>[r(b,{onClick:i.searchFilter,variant:"primary mt-1 w-100"},{default:o(()=>e[24]||(e[24]=[c(" Search ")])),_:1},8,["onClick"])]),_:1}),r(_,{md:"2"},{default:o(()=>[r(b,{onClick:i.resetFilter,variant:"primary mt-1 w-100"},{default:o(()=>e[25]||(e[25]=[c(" Reset ")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})])):p("",!0),s("div",te,[l.modalLoading?p("",!0):(d(),m("div",se,[r(E,{responsive:"",stacked:"sm",ref:"refRequestListTable",items:l.fetchRequests,fields:l.fields,onSortChanged:i.onSortChanged,class:"mb-2 staticTable","empty-text":"No matching records found"},{"cell(transaction_id)":o(a=>[s("span",ae,h(a.item.transaction_id),1)]),"cell(amount)":o(a=>[c(" â‚¹"+h(a.item.amount.toLocaleString()),1)]),"cell(status)":o(a=>[r(U,{variant:i.getStatusVariant(a.item.status)},{default:o(()=>[c(h(a.item.status),1)]),_:2},1032,["variant"]),a.item.status==="rejected"&&a.item.reject_reason?(d(),m("div",le," Reason: "+h(a.item.reject_reason),1)):p("",!0)]),"cell(image_path)":o(a=>[r(L,{onClick:v=>i.showImage(a.item.image_path),class:"text-primary cursor-pointer"},{default:o(()=>e[26]||(e[26]=[c(" View Receipt ")])),_:2},1032,["onClick"])]),"cell(actions)":o(a=>[a.item.status==="pending"&&l.isAdmin?(d(),m(j,{key:0},[r(b,{size:"sm",variant:"success",onClick:v=>i.approveRequest(a.item)},{default:o(()=>e[27]||(e[27]=[c(" Approve ")])),_:2},1032,["onClick"]),r(b,{size:"sm",variant:"danger",onClick:v=>i.rejectRequest(a.item),class:"ml-1"},{default:o(()=>e[28]||(e[28]=[c(" Reject ")])),_:2},1032,["onClick"])],64)):!l.isAdmin&&a.item.request_by===l.currentUserId&&a.item.status==="pending"?(d(),m(j,{key:1},[r(b,{size:"sm",variant:"primary",onClick:v=>i.openRequestModal(a.item.id),class:"ml-1"},{default:o(()=>e[29]||(e[29]=[c(" Edit ")])),_:2},1032,["onClick"]),r(b,{size:"sm",variant:"danger",onClick:v=>i.deleteRequest(a.item.id),class:"ml-1"},{default:o(()=>e[30]||(e[30]=[c(" Delete ")])),_:2},1032,["onClick"])],64)):(d(),m("span",oe,"No actions available"))]),_:1},8,["items","fields","onSortChanged"])])),l.modalLoading?(d(),m("div",re,e[31]||(e[31]=[s("i",{class:"fas fa-spinner fa-spin fa-3x"},null,-1)]))):p("",!0),s("div",ie,[r(R,{class:"align-items-center"},{default:o(()=>[r(_,{cols:"12",md:"4"},{default:o(()=>[l.modalLoading?p("",!0):(d(),m("div",ne,[e[32]||(e[32]=s("span",{class:"mr-2 showing_pagination_result"},"Show",-1)),r(D,{modelValue:u.perPage,"onUpdate:modelValue":e[7]||(e[7]=a=>u.perPage=a),options:u.perPageOptions,clearable:!1,class:"mr-2"},null,8,["modelValue","options"]),e[33]||(e[33]=s("span",{class:"showing_pagination_result"},"entries",-1))]))]),_:1}),l.modalLoading?p("",!0):(d(),q(_,{key:0,cols:"12",md:"4"},{default:o(()=>[s("div",de,[s("span",ue,"Showing "+h(i.rangeStart)+" to "+h(i.rangeEnd)+" of "+h(l.totalrows)+" entries",1)])]),_:1})),r(_,{cols:"12",md:"4"},{default:o(()=>[s("div",ce,[l.totalrows>0&&!l.modalLoading?(d(),q(I,{key:0,modelValue:u.currentPage,"onUpdate:modelValue":e[8]||(e[8]=a=>u.currentPage=a),"total-rows":l.totalrows,"per-page":u.perPage,onInput:t.fetchEntries,pills:"","first-number":"","last-number":"","prev-class":"prev-item","next-class":"next-item"},{"prev-text":o(()=>e[34]||(e[34]=[s("i",{class:"fa-solid fa-angles-left"},null,-1)])),"next-text":o(()=>e[35]||(e[35]=[s("i",{class:"fa-solid fa-angles-right"},null,-1)])),_:1},8,["modelValue","total-rows","per-page","onInput"])):p("",!0)])]),_:1})]),_:1})])]),r(y,{modelValue:l.showRequestModal,"onUpdate:modelValue":e[15]||(e[15]=a=>l.showRequestModal=a),onHide:i.resetModal,centered:"",size:"lg","hide-footer":"","modal-class":"modern-modal","header-class":"modern-modal-header","body-class":"modern-modal-body"},{"modal-header":o(({close:a})=>[s("div",me,[e[37]||(e[37]=s("div",{class:"modal-icon"},[s("i",{class:"fas fa-money-bill-wave"})],-1)),e[38]||(e[38]=s("div",{class:"modal-title-section"},[s("h4",{class:"modal-title"},"Create Withdrawal Request"),s("p",{class:"modal-subtitle"},"Withdraw funds from your account")],-1)),s("button",{type:"button",class:"modal-close-btn",onClick:v=>a()},e[36]||(e[36]=[s("i",{class:"fas fa-times"},null,-1)]),8,fe)])]),default:o(()=>[l.modalLoading?(d(),m("div",he,e[39]||(e[39]=[s("div",{class:"loading-spinner"},[s("i",{class:"fas fa-spinner fa-spin"})],-1),s("p",{class:"loading-text"},"Loading your account information...",-1)]))):l.canWithdraw?(d(),m("div",_e,[s("div",we,[e[44]||(e[44]=s("div",{class:"balance-icon"},[s("i",{class:"fas fa-wallet"})],-1)),s("div",ve,[e[43]||(e[43]=s("span",{class:"balance-label"},"Available Balance",-1)),s("span",qe,"â‚¹"+h(i.formatBalance(l.availableBalance)),1)])]),s("form",{onSubmit:e[14]||(e[14]=N((...a)=>i.submitRequest&&i.submitRequest(...a),["prevent"])),class:"withdrawal-form"},[s("div",Re,[e[47]||(e[47]=s("label",{class:"form-label-modern"},[s("i",{class:"fas fa-rupee-sign"}),c(" Amount (â‚¹) ")],-1)),s("div",ye,[k(s("input",{type:"number","onUpdate:modelValue":e[10]||(e[10]=a=>l.requestData.amount=a),required:"",min:"1",max:l.availableBalance,placeholder:"Enter amount",class:V(["form-input-modern",{error:i.hasErrors("amount")}]),onInput:e[11]||(e[11]=a=>i.removeError("amount"))},null,42,ke),[[x,l.requestData.amount]]),e[45]||(e[45]=s("div",{class:"input-icon"},[s("i",{class:"fas fa-rupee-sign"})],-1))]),s("div",Me," Maximum withdrawal: â‚¹"+h(i.formatBalance(l.availableBalance)),1),i.hasErrors("amount")?(d(),m("div",De,[e[46]||(e[46]=s("i",{class:"fas fa-exclamation-circle"},null,-1)),c(" "+h(i.getErrors("amount")),1)])):p("",!0)]),s("div",Ce,[e[48]||(e[48]=s("label",{class:"form-label-modern"},[s("i",{class:"fas fa-comment-alt"}),c(" Description ")],-1)),s("div",Ve,[k(s("textarea",{"onUpdate:modelValue":e[12]||(e[12]=a=>l.requestData.description=a),rows:"3",placeholder:"Optional description...",class:"form-textarea-modern"},null,512),[[x,l.requestData.description]])]),e[49]||(e[49]=s("div",{class:"input-help"}," Provide additional details about this withdrawal (optional) ",-1))]),s("div",je,[s("button",{type:"button",class:"btn-cancel",onClick:e[13]||(e[13]=(...a)=>i.closeModal&&i.closeModal(...a))},e[50]||(e[50]=[s("i",{class:"fas fa-times"},null,-1),c(" Cancel ")])),s("button",{type:"submit",class:"btn-submit",disabled:l.loading},[l.loading?(d(),m("span",Se,e[51]||(e[51]=[s("i",{class:"fas fa-spinner fa-spin"},null,-1),c(" Processing... ")]))):(d(),m("span",Pe,e[52]||(e[52]=[s("i",{class:"fas fa-paper-plane"},null,-1),c(" Submit Request ")])))],8,xe)])],32)])):(d(),m("div",pe,[e[41]||(e[41]=s("div",{class:"error-icon"},[s("i",{class:"fas fa-exclamation-triangle"})],-1)),e[42]||(e[42]=s("h5",{class:"error-title"},"Unable to Process Withdrawal",-1)),s("p",ge,h(l.errorMessage),1),s("div",be,[s("button",{class:"btn-secondary",onClick:e[9]||(e[9]=(...a)=>i.resetModal&&i.resetModal(...a))},e[40]||(e[40]=[s("i",{class:"fas fa-arrow-left"},null,-1),c(" Go Back ")]))])]))]),_:1},8,["modelValue","onHide"]),r(y,{modelValue:l.showImageModal,"onUpdate:modelValue":e[16]||(e[16]=a=>l.showImageModal=a),title:"Payment Receipt",centered:""},{"modal-footer":o(()=>[r(b,{variant:"primary",onClick:i.downloadImage},{default:o(()=>e[53]||(e[53]=[c("Download")])),_:1},8,["onClick"])]),default:o(()=>[s("div",Be,[s("img",{src:l.imagePreviewUrl,alt:"Payment Receipt",class:"img-fluid"},null,8,Ue)])]),_:1},8,["modelValue"]),r(y,{modelValue:l.showRejectModal,"onUpdate:modelValue":e[18]||(e[18]=a=>l.showRejectModal=a),title:"Reject Request",centered:"",onOk:i.confirmReject},{default:o(()=>[r(w,{label:"Reject Reason","label-for":"rejectReason"},{default:o(()=>[r(A,{id:"rejectReason",modelValue:l.rejectReason,"onUpdate:modelValue":e[17]||(e[17]=a=>l.rejectReason=a),rows:"3",required:"",placeholder:"Please specify the reason for rejection..."},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue","onOk"])])])}const Oe=F(z,[["render",Le],["__scopeId","data-v-3032d193"]]);export{Oe as default};
