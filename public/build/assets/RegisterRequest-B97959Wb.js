import{_ as W,f as c,D as v,L as z,E as H,c as i,o as r,b as t,i as k,n as q,t as n,j as D,v as Y,W as x,l as O,h as P,F as Z,r as J}from"./app-BFj7m03g.js";import{A as Q}from"./AdminMobileNav-DI3t1v3n.js";const G={class:"register-request-screen"},K={class:"page-header"},ee={class:"header-content"},te={class:"header-right"},se=["disabled"],ae={class:"stats-cards"},oe={class:"stat-card"},ne={class:"stat-content"},le={class:"stat-number"},ie={class:"stat-card"},re={class:"stat-content"},de={class:"stat-number"},ue={class:"stat-card"},ce={class:"stat-content"},pe={class:"stat-number"},ve={class:"filters-section"},ge={class:"search-box"},fe={class:"filter-options"},he={class:"results-info"},me={class:"results-count"},_e={class:"requests-container"},we={key:0,class:"loading-state"},ye={key:1,class:"error-state"},be={key:2,class:"empty-state"},ke={key:3,class:"requests-list"},De={class:"request-header"},je={class:"user-info"},Re={class:"user-avatar"},Ae=["src","alt","onError","onLoad"],Ce={class:"user-details"},Ee={class:"user-name"},qe={class:"user-email"},xe={class:"user-phone"},$e={class:"request-status"},Pe={class:"request-body"},Se={class:"request-meta"},Fe={class:"meta-item"},Me={class:"meta-item"},Te={key:0,class:"request-actions"},Le=["onClick","disabled"],Ie={key:0},Ne={key:1},Ue=["onClick","disabled"],Be={key:0},Ve={key:1},Xe={key:1,class:"request-actions"},We={class:"processed-info"},ze={key:0,class:"approved-info"},He={key:1,class:"rejected-info"},Ye={key:4,class:"pagination"},Oe=["disabled"],Ze=["disabled"],Je={class:"page-info"},Qe=["disabled"],Ge=["disabled"],Ke={__name:"RegisterRequest",setup(et){const g=c(!1),j=c(null),d=c([]),f=c(""),h=c("all"),m=c("all"),y=c("latest"),u=c(1),R=c(10),p=c(null),A=`${window.location.origin}/api`,b=v(()=>{let a=d.value;if(f.value){const e=f.value.toLowerCase();a=a.filter(s=>s.name.toLowerCase().includes(e)||s.email.toLowerCase().includes(e)||s.phone.includes(e))}if(h.value!=="all"&&(a=a.filter(e=>e.status===h.value)),m.value!=="all"){const e=new Date,s=new Date(e.getFullYear(),e.getMonth(),e.getDate());a=a.filter(o=>{const l=new Date(o.created_at);switch(m.value){case"today":return l>=s;case"week":const w=new Date(s.getTime()-7*24*60*60*1e3);return l>=w;case"month":const X=new Date(s.getFullYear(),s.getMonth()-1,s.getDate());return l>=X;default:return!0}})}return a.sort((e,s)=>{switch(y.value){case"latest":return new Date(s.created_at)-new Date(e.created_at);case"oldest":return new Date(e.created_at)-new Date(s.created_at);case"name":return e.name.localeCompare(s.name);case"email":return e.email.localeCompare(s.email);default:return new Date(s.created_at)-new Date(e.created_at)}}),a}),S=v(()=>{const a=(u.value-1)*R.value,e=a+R.value;return b.value.slice(a,e)}),_=v(()=>Math.ceil(b.value.length/R.value)),F=v(()=>d.value.filter(a=>a.status==="pending").length),M=v(()=>{const a=new Date,e=new Date(a.getFullYear(),a.getMonth(),a.getDate());return d.value.filter(s=>s.status==="approved"&&new Date(s.updated_at)>=e).length}),T=v(()=>{const a=new Date,e=new Date(a.getFullYear(),a.getMonth(),a.getDate());return d.value.filter(s=>s.status==="rejected"&&new Date(s.updated_at)>=e).length});z([f,h,m,y],()=>{u.value=1});const L=a=>a?a.startsWith("http")?a:`${window.location.origin}/storage/${a}`:"/build/assets/tableprofileimg-DaN7tIxX.png",I=(a,e)=>{console.log(`Profile image failed to load for ${e}, creating initials fallback`),console.log("Failed image src:",a.target.src),a.target.style.display="none";const s=e.split(" ").map(l=>l[0]).join("").toUpperCase().substring(0,3),o=document.createElement("div");o.className="profile-initials-fallback",o.textContent=s,o.style.cssText=`
    width: 45px;
    height: 45px;
    border-radius: 50%;
    background: linear-gradient(135deg, #00ff80, #00cc66);
    color: #000;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 14px;
    border: 3px solid #00ff80;
  `,a.target.parentNode.appendChild(o)},C=async()=>{try{g.value=!0,j.value=null;const a=localStorage.getItem("access_token");if(!a)throw new Error("No access token found. Please login again.");const e=await fetch(`${A}/register-requests`,{headers:{Authorization:`Bearer ${a}`,Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(e.status===401)throw new Error("Authentication failed. Please login again.");if(!e.ok){const o=await e.json();throw new Error(o.message||"Failed to fetch requests")}const s=await e.json();if(s.success)d.value=s.data;else throw new Error(s.message||"Failed to fetch requests")}catch(a){console.error("Error fetching requests:",a),a.value=a.message}finally{g.value=!1}},N=async a=>{try{p.value=a.id;const e=localStorage.getItem("access_token");if(!e)throw new Error("No access token found. Please login again.");const s=await fetch(`${A}/register-requests/${a.id}/approve`,{method:"PATCH",headers:{Authorization:`Bearer ${e}`,Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(s.status===401)throw new Error("Authentication failed. Please login again.");if(!s.ok){const l=await s.json();throw new Error(l.message||"Failed to approve request")}const o=await s.json();if(o.success){const l=d.value.findIndex(w=>w.id===a.id);l!==-1&&(d.value[l].status="approved",d.value[l].updated_at=new Date().toISOString()),alert("User registration approved successfully!")}else throw new Error(o.message||"Failed to approve request")}catch(e){console.error("Error approving request:",e),alert(`Error approving request: ${e.message}`)}finally{p.value=null}},U=async a=>{try{p.value=a.id;const e=localStorage.getItem("access_token");if(!e)throw new Error("No access token found. Please login again.");const s=await fetch(`${A}/register-requests/${a.id}/reject`,{method:"PATCH",headers:{Authorization:`Bearer ${e}`,Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(s.status===401)throw new Error("Authentication failed. Please login again.");if(!s.ok){const l=await s.json();throw new Error(l.message||"Failed to reject request")}const o=await s.json();if(o.success){const l=d.value.findIndex(w=>w.id===a.id);l!==-1&&(d.value[l].status="rejected",d.value[l].updated_at=new Date().toISOString()),alert("User registration rejected successfully!")}else throw new Error(o.message||"Failed to reject request")}catch(e){console.error("Error rejecting request:",e),alert(`Error rejecting request: ${e.message}`)}finally{p.value=null}},$=a=>({pending:"status-pending",approved:"status-approved",rejected:"status-rejected"})[a]||"status-pending",B=a=>({pending:"Pending",approved:"Approved",rejected:"Rejected"})[a]||"Pending",E=a=>new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),V=a=>{const e=new Date,s=new Date(a),o=Math.floor((e-s)/(1e3*60));return o<1?"Just now":o<60?`${o} minutes ago`:o<1440?`${Math.floor(o/60)} hours ago`:`${Math.floor(o/1440)} days ago`};return H(()=>{C()}),(a,e)=>(r(),i("div",G,[t("div",K,[t("div",ee,[e[9]||(e[9]=t("div",{class:"header-left"},[t("h1",{class:"page-title"},[t("i",{class:"fa-solid fa-user-plus"}),k(" Register Request ")]),t("p",{class:"page-subtitle"}," Review and approve new user registration requests ")],-1)),t("div",te,[t("button",{class:"btn-refresh",onClick:C,disabled:g.value},[t("i",{class:q(["fa-solid fa-rotate",{"fa-spin":g.value}])},null,2),e[8]||(e[8]=k(" Refresh "))],8,se)])])]),t("div",ae,[t("div",oe,[e[11]||(e[11]=t("div",{class:"stat-icon pending"},"📝",-1)),t("div",ne,[t("h3",le,n(F.value),1),e[10]||(e[10]=t("p",{class:"stat-label"},"Pending Requests",-1))])]),t("div",ie,[e[13]||(e[13]=t("div",{class:"stat-icon approved"},"✅",-1)),t("div",re,[t("h3",de,n(M.value),1),e[12]||(e[12]=t("p",{class:"stat-label"},"Approved Today",-1))])]),t("div",ue,[e[15]||(e[15]=t("div",{class:"stat-icon rejected"},"❌",-1)),t("div",ce,[t("h3",pe,n(T.value),1),e[14]||(e[14]=t("p",{class:"stat-label"},"Rejected Today",-1))])])]),t("div",ve,[t("div",ge,[e[16]||(e[16]=t("i",{class:"fa-solid fa-search"},null,-1)),D(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=s=>f.value=s),placeholder:"Search by name, email, or phone...",class:"search-input"},null,512),[[Y,f.value]])]),t("div",fe,[D(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>h.value=s),class:"filter-select"},e[17]||(e[17]=[t("option",{value:"all"},"All Status",-1),t("option",{value:"pending"},"Pending",-1),t("option",{value:"approved"},"Approved",-1),t("option",{value:"rejected"},"Rejected",-1)]),512),[[x,h.value]]),D(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>m.value=s),class:"filter-select"},e[18]||(e[18]=[t("option",{value:"all"},"All Time",-1),t("option",{value:"today"},"Today",-1),t("option",{value:"week"},"This Week",-1),t("option",{value:"month"},"This Month",-1)]),512),[[x,m.value]]),D(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>y.value=s),class:"filter-select"},e[19]||(e[19]=[t("option",{value:"latest"},"🕐 Latest First",-1),t("option",{value:"oldest"},"🕐 Oldest First",-1),t("option",{value:"name"},"🔤 Name A-Z",-1),t("option",{value:"email"},"📧 Email A-Z",-1)]),512),[[x,y.value]])]),t("div",he,[t("span",me," Showing "+n(b.value.length)+" of "+n(d.value.length)+" requests ",1)])]),t("div",_e,[O(Q),g.value?(r(),i("div",we,e[20]||(e[20]=[t("i",{class:"fa-solid fa-spinner fa-spin"},null,-1),t("p",null,"Loading registration requests...",-1)]))):j.value?(r(),i("div",ye,[e[21]||(e[21]=t("i",{class:"fa-solid fa-exclamation-triangle"},null,-1)),t("p",null,n(j.value),1),t("button",{class:"btn-retry",onClick:C},"Retry")])):b.value.length===0?(r(),i("div",be,e[22]||(e[22]=[t("i",{class:"fa-solid fa-inbox"},null,-1),t("p",null,"No registration requests found",-1)]))):(r(),i("div",ke,[(r(!0),i(Z,null,J(S.value,s=>(r(),i("div",{key:s.id,class:q(["request-card",$(s.status)])},[t("div",De,[t("div",je,[t("div",Re,[t("img",{src:L(s.profile_image),alt:s.name,onError:o=>I(o,s.name),onLoad:()=>console.log("Profile image loaded successfully for:",s.name)},null,40,Ae)]),t("div",Ce,[t("h4",Ee,n(s.name),1),t("p",qe,n(s.email),1),t("p",xe,n(s.phone),1)])]),t("div",$e,[t("span",{class:q(["status-badge",$(s.status)])},n(B(s.status)),3)])]),t("div",Pe,[t("div",Se,[t("div",Fe,[e[23]||(e[23]=t("i",{class:"fa-solid fa-calendar"},null,-1)),t("span",null,"Requested: "+n(E(s.created_at)),1)]),t("div",Me,[e[24]||(e[24]=t("i",{class:"fa-solid fa-clock"},null,-1)),t("span",null,n(V(s.created_at)),1)])]),s.status==="pending"?(r(),i("div",Te,[t("button",{class:"btn-approve",onClick:o=>N(s),disabled:p.value===s.id},[e[25]||(e[25]=t("i",{class:"fa-solid fa-check"},null,-1)),p.value===s.id?(r(),i("span",Ie,"Approving...")):(r(),i("span",Ne,"Approve"))],8,Le),t("button",{class:"btn-reject",onClick:o=>U(s),disabled:p.value===s.id},[e[26]||(e[26]=t("i",{class:"fa-solid fa-times"},null,-1)),p.value===s.id?(r(),i("span",Be,"Rejecting...")):(r(),i("span",Ve,"Reject"))],8,Ue)])):(r(),i("div",Xe,[t("div",We,[s.status==="approved"?(r(),i("span",ze,[e[27]||(e[27]=t("i",{class:"fa-solid fa-check-circle"},null,-1)),k(" Approved by "+n(s.approved_by||"Admin")+" on "+n(E(s.updated_at)),1)])):s.status==="rejected"?(r(),i("span",He,[e[28]||(e[28]=t("i",{class:"fa-solid fa-times-circle"},null,-1)),k(" Rejected by "+n(s.rejected_by||"Admin")+" on "+n(E(s.updated_at)),1)])):P("",!0)])]))])],2))),128))])),_.value>1?(r(),i("div",Ye,[t("button",{class:"btn-page",disabled:u.value===1,onClick:e[4]||(e[4]=s=>u.value=1)},e[29]||(e[29]=[t("i",{class:"fa-solid fa-angles-left"},null,-1)]),8,Oe),t("button",{class:"btn-page",disabled:u.value===1,onClick:e[5]||(e[5]=s=>u.value--)},e[30]||(e[30]=[t("i",{class:"fa-solid fa-angle-left"},null,-1)]),8,Ze),t("span",Je," Page "+n(u.value)+" of "+n(_.value),1),t("button",{class:"btn-page",disabled:u.value===_.value,onClick:e[6]||(e[6]=s=>u.value++)},e[31]||(e[31]=[t("i",{class:"fa-solid fa-angle-right"},null,-1)]),8,Qe),t("button",{class:"btn-page",disabled:u.value===_.value,onClick:e[7]||(e[7]=s=>u.value=_.value)},e[32]||(e[32]=[t("i",{class:"fa-solid fa-angles-right"},null,-1)]),8,Ge)])):P("",!0)])]))}},at=W(Ke,[["__scopeId","data-v-a78b7345"]]);export{at as default};
