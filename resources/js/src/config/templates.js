/**
 * UI Template System
 * 5 Predefined Color Themes
 * Select from Admin Dashboard -> Template Settings
 */

export const templates = {
  template1: {
    id: 'template1',
    name: 'Green Tech (Default)',
    description: 'Modern green tech theme with dark backgrounds',
    colors: {
      primary: '#00ff88',
      primaryDark: '#00cc66',
      primaryLight: '#00d4aa',
      bgPrimary: '#0d0d1a',
      bgSecondary: '#101022',
      bgTertiary: '#1a1a2e',
      bgQuaternary: '#16213e',
      textPrimary: '#ffffff',
      textSecondary: 'rgba(255, 255, 255, 0.7)',
      textMuted: '#9ca3af',
      success: '#00ff88',
      error: '#ff4444',
      warning: '#ffaa00',
      borderPrimary: 'rgba(0, 255, 136, 0.2)',
      borderSecondary: 'rgba(255, 255, 255, 0.1)',
    }
  },
  template2: {
    id: 'template2',
    name: 'Blue Ocean',
    description: 'Calm blue ocean theme with professional look',
    colors: {
      primary: '#3b82f6',
      primaryDark: '#2563eb',
      primaryLight: '#60a5fa',
      bgPrimary: '#0f172a',
      bgSecondary: '#1e293b',
      bgTertiary: '#334155',
      bgQuaternary: '#475569',
      textPrimary: '#ffffff',
      textSecondary: 'rgba(255, 255, 255, 0.7)',
      textMuted: '#94a3b8',
      success: '#10b981',
      error: '#ef4444',
      warning: '#f59e0b',
      borderPrimary: 'rgba(59, 130, 246, 0.2)',
      borderSecondary: 'rgba(255, 255, 255, 0.1)',
    }
  },
  template3: {
    id: 'template3',
    name: 'Purple Royal',
    description: 'Elegant purple royal theme with luxury feel',
    colors: {
      primary: '#8b5cf6',
      primaryDark: '#7c3aed',
      primaryLight: '#a78bfa',
      bgPrimary: '#1a0b2e',
      bgSecondary: '#2d1b3d',
      bgTertiary: '#3d2a4d',
      bgQuaternary: '#4d3a5d',
      textPrimary: '#ffffff',
      textSecondary: 'rgba(255, 255, 255, 0.7)',
      textMuted: '#a78bfa',
      success: '#10b981',
      error: '#f43f5e',
      warning: '#f59e0b',
      borderPrimary: 'rgba(139, 92, 246, 0.2)',
      borderSecondary: 'rgba(255, 255, 255, 0.1)',
    }
  },
  template4: {
    id: 'template4',
    name: 'Orange Fire',
    description: 'Energetic orange fire theme with vibrant colors',
    colors: {
      primary: '#f97316',
      primaryDark: '#ea580c',
      primaryLight: '#fb923c',
      bgPrimary: '#1c0a00',
      bgSecondary: '#2d1500',
      bgTertiary: '#3d1f00',
      bgQuaternary: '#4d2900',
      textPrimary: '#ffffff',
      textSecondary: 'rgba(255, 255, 255, 0.7)',
      textMuted: '#fb923c',
      success: '#10b981',
      error: '#ef4444',
      warning: '#f59e0b',
      borderPrimary: 'rgba(249, 115, 22, 0.2)',
      borderSecondary: 'rgba(255, 255, 255, 0.1)',
    }
  },
  template5: {
    id: 'template5',
    name: 'Cyan Modern',
    description: 'Modern cyan theme with fresh and clean design',
    colors: {
      primary: '#06b6d4',
      primaryDark: '#0891b2',
      primaryLight: '#22d3ee',
      bgPrimary: '#0a1628',
      bgSecondary: '#1a2838',
      bgTertiary: '#2a3848',
      bgQuaternary: '#3a4858',
      textPrimary: '#ffffff',
      textSecondary: 'rgba(255, 255, 255, 0.7)',
      textMuted: '#67e8f9',
      success: '#10b981',
      error: '#ef4444',
      warning: '#f59e0b',
      borderPrimary: 'rgba(6, 182, 212, 0.2)',
      borderSecondary: 'rgba(255, 255, 255, 0.1)',
    }
  },
  template6: {
    id: 'template6',
    name: 'Red Energy',
    description: 'Bold red energy theme with high contrast',
    colors: {
      primary: '#ef4444',
      primaryDark: '#dc2626',
      primaryLight: '#f87171',
      bgPrimary: '#1a0000',
      bgSecondary: '#2d0000',
      bgTertiary: '#3d0000',
      bgQuaternary: '#4d0000',
      textPrimary: '#ffffff',
      textSecondary: 'rgba(255, 255, 255, 0.7)',
      textMuted: '#fca5a5',
      success: '#10b981',
      error: '#ef4444',
      warning: '#f59e0b',
      borderPrimary: 'rgba(239, 68, 68, 0.2)',
      borderSecondary: 'rgba(255, 255, 255, 0.1)',
    }
  },
  template7: {
    id: 'template7',
    name: 'Pink Neon',
    description: 'Vibrant pink neon theme with modern appeal',
    colors: {
      primary: '#ec4899',
      primaryDark: '#db2777',
      primaryLight: '#f472b6',
      bgPrimary: '#1a0a14',
      bgSecondary: '#2d1a24',
      bgTertiary: '#3d2a34',
      bgQuaternary: '#4d3a44',
      textPrimary: '#ffffff',
      textSecondary: 'rgba(255, 255, 255, 0.7)',
      textMuted: '#f9a8d4',
      success: '#10b981',
      error: '#ef4444',
      warning: '#f59e0b',
      borderPrimary: 'rgba(236, 72, 153, 0.2)',
      borderSecondary: 'rgba(255, 255, 255, 0.1)',
    }
  },
  template8: {
    id: 'template8',
    name: 'Teal Ocean',
    description: 'Calm teal ocean theme with serene vibes',
    colors: {
      primary: '#14b8a6',
      primaryDark: '#0d9488',
      primaryLight: '#5eead4',
      bgPrimary: '#0a1a18',
      bgSecondary: '#1a2a28',
      bgTertiary: '#2a3a38',
      bgQuaternary: '#3a4a48',
      textPrimary: '#ffffff',
      textSecondary: 'rgba(255, 255, 255, 0.7)',
      textMuted: '#99f6e4',
      success: '#10b981',
      error: '#ef4444',
      warning: '#f59e0b',
      borderPrimary: 'rgba(20, 184, 166, 0.2)',
      borderSecondary: 'rgba(255, 255, 255, 0.1)',
    }
  },
  template9: {
    id: 'template9',
    name: 'Gold Luxury',
    description: 'Premium gold luxury theme with elegance',
    colors: {
      primary: '#fbbf24',
      primaryDark: '#f59e0b',
      primaryLight: '#fcd34d',
      bgPrimary: '#1a1400',
      bgSecondary: '#2d2400',
      bgTertiary: '#3d3400',
      bgQuaternary: '#4d4400',
      textPrimary: '#ffffff',
      textSecondary: 'rgba(255, 255, 255, 0.7)',
      textMuted: '#fde68a',
      success: '#10b981',
      error: '#ef4444',
      warning: '#f59e0b',
      borderPrimary: 'rgba(251, 191, 36, 0.2)',
      borderSecondary: 'rgba(255, 255, 255, 0.1)',
    }
  },
  template10: {
    id: 'template10',
    name: 'Indigo Night',
    description: 'Deep indigo night theme with sophistication',
    colors: {
      primary: '#6366f1',
      primaryDark: '#4f46e5',
      primaryLight: '#818cf8',
      bgPrimary: '#0f0f1a',
      bgSecondary: '#1a1a2e',
      bgTertiary: '#2a2a3e',
      bgQuaternary: '#3a3a4e',
      textPrimary: '#ffffff',
      textSecondary: 'rgba(255, 255, 255, 0.7)',
      textMuted: '#a5b4fc',
      success: '#10b981',
      error: '#ef4444',
      warning: '#f59e0b',
      borderPrimary: 'rgba(99, 102, 241, 0.2)',
      borderSecondary: 'rgba(255, 255, 255, 0.1)',
    }
  }
};

// Get custom templates from localStorage
export const getCustomTemplates = () => {
  try {
    const custom = localStorage.getItem('customTemplates');
    return custom ? JSON.parse(custom) : {};
  } catch (e) {
    console.warn('Failed to load custom templates:', e);
    return {};
  }
};

// Save custom templates to localStorage
export const saveCustomTemplates = (customTemplates) => {
  try {
    localStorage.setItem('customTemplates', JSON.stringify(customTemplates));
    return true;
  } catch (e) {
    console.error('Failed to save custom templates:', e);
    return false;
  }
};

// Get all templates (predefined + custom)
export const getAllTemplates = () => {
  const custom = getCustomTemplates();
  return { ...templates, ...custom };
};

// Get current template from localStorage
export const getCurrentTemplate = () => {
  try {
    const saved = localStorage.getItem('selectedTemplate');
    const allTemplates = getAllTemplates();
    if (saved && allTemplates[saved]) {
      return allTemplates[saved];
    }
  } catch (e) {
    console.warn('Failed to load template:', e);
  }
  return templates.template1; // Default template
};

// Add or update a custom template
export const saveCustomTemplate = (templateId, templateData) => {
  const custom = getCustomTemplates();
  custom[templateId] = {
    ...templateData,
    id: templateId,
    isCustom: true
  };
  return saveCustomTemplates(custom);
};

// Delete a custom template
export const deleteCustomTemplate = (templateId) => {
  const custom = getCustomTemplates();
  delete custom[templateId];
  return saveCustomTemplates(custom);
};

// Helper to convert hex to RGB
const hexToRgb = (hex) => {
  const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
  return result ? {
    r: parseInt(result[1], 16),
    g: parseInt(result[2], 16),
    b: parseInt(result[3], 16)
  } : null;
};

// Apply template to document
export const applyTemplate = (templateId) => {
  const allTemplates = getAllTemplates();
  const template = allTemplates[templateId] || templates.template1;
  const root = document.documentElement;
  const colors = template.colors;

  // Apply CSS variables
  root.style.setProperty('--color-primary', colors.primary);
  root.style.setProperty('--color-primary-dark', colors.primaryDark);
  root.style.setProperty('--color-primary-light', colors.primaryLight);
  root.style.setProperty('--color-bg-primary', colors.bgPrimary);
  root.style.setProperty('--color-bg-secondary', colors.bgSecondary);
  root.style.setProperty('--color-bg-tertiary', colors.bgTertiary);
  root.style.setProperty('--color-bg-quaternary', colors.bgQuaternary);
  root.style.setProperty('--color-text-primary', colors.textPrimary);
  root.style.setProperty('--color-text-secondary', colors.textSecondary);
  root.style.setProperty('--color-text-muted', colors.textMuted);
  root.style.setProperty('--color-success', colors.success);
  root.style.setProperty('--color-error', colors.error);
  root.style.setProperty('--color-warning', colors.warning);
  root.style.setProperty('--color-border-primary', colors.borderPrimary);
  root.style.setProperty('--color-border-secondary', colors.borderSecondary);

  // Convert primary color to RGB for rgba() usage
  const primaryRgb = hexToRgb(colors.primary);
  if (primaryRgb) {
    root.style.setProperty('--color-primary-rgb', `${primaryRgb.r}, ${primaryRgb.g}, ${primaryRgb.b}`);
  }
  
  // Also convert other colors to RGB
  const successRgb = hexToRgb(colors.success);
  const errorRgb = hexToRgb(colors.error);
  const warningRgb = hexToRgb(colors.warning);
  const primaryLightRgb = hexToRgb(colors.primaryLight);
  
  if (successRgb) {
    root.style.setProperty('--color-success-rgb', `${successRgb.r}, ${successRgb.g}, ${successRgb.b}`);
  }
  if (errorRgb) {
    root.style.setProperty('--color-error-rgb', `${errorRgb.r}, ${errorRgb.g}, ${errorRgb.b}`);
  }
  if (warningRgb) {
    root.style.setProperty('--color-warning-rgb', `${warningRgb.r}, ${warningRgb.g}, ${warningRgb.b}`);
  }
  if (primaryLightRgb) {
    root.style.setProperty('--color-primary-light-rgb', `${primaryLightRgb.r}, ${primaryLightRgb.g}, ${primaryLightRgb.b}`);
  }

  // Common color variations for backward compatibility
  root.style.setProperty('--color-primary-80', colors.primary); // Same as primary
  root.style.setProperty('--color-primary-alpha-10', colors.borderPrimary);
  root.style.setProperty('--color-primary-alpha-20', colors.borderPrimary);
  root.style.setProperty('--color-primary-alpha-30', colors.borderPrimary.replace('0.2', '0.3'));

  // Force update body and html background for immediate visual feedback
  if (typeof document !== 'undefined') {
    if (document.body) {
      document.body.style.backgroundColor = colors.bgPrimary;
    }
    if (document.documentElement) {
      document.documentElement.style.backgroundColor = colors.bgPrimary;
    }
  }

  // Save to localStorage
  localStorage.setItem('selectedTemplate', templateId);
  
  // Dispatch event for components to react
  window.dispatchEvent(new CustomEvent('templateChanged', { detail: template }));
  
  return template;
};

// Initialize template on load
if (typeof window !== 'undefined') {
  const currentTemplate = getCurrentTemplate();
  applyTemplate(currentTemplate.id);
}

